/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var sn=Object.create;var fe=Object.defineProperty;var ln=Object.getOwnPropertyDescriptor;var cn=Object.getOwnPropertyNames;var pn=Object.getPrototypeOf,fn=Object.prototype.hasOwnProperty;var dn=(e,t)=>{for(var n in t)fe(e,n,{get:t[n],enumerable:!0})},ct=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of cn(t))!fn.call(e,r)&&r!==n&&fe(e,r,{get:()=>t[r],enumerable:!(i=ln(t,r))||i.enumerable});return e};var q=(e,t,n)=>(n=e!=null?sn(pn(e)):{},ct(t||!e||!e.__esModule?fe(n,"default",{value:e,enumerable:!0}):n,e)),un=e=>ct(fe({},"__esModule",{value:!0}),e);var Li={};dn(Li,{default:()=>Ye});module.exports=un(Li);var on=require("obsidian");var pt={projectRoot:"",configFilePath:"",contentTypes:[],frontmatterProperties:{},preset:"vanilla",enableWYSIWYG:!1,enabledPlugins:[],disabledPlugins:[],theme:"",basesCMSConfig:{views:[]},astroComposerConfig:{customContentTypes:[],defaultTemplate:"",configFilePath:"",terminalProjectRootPath:""},seoConfig:{titleProperty:"title",descriptionProperty:void 0,scanDirectories:"",useFilenameAsTitle:!1,useFilenameAsSlug:!0},commanderConfig:{pageHeaderCommands:[]},propertyOverFileName:{propertyKey:"title"},imageInserter:{valueFormat:"[[attachments/{image-url}]]",insertFormat:"[[attachments/{image-url}]]"},runWizardOnStartup:!0,wizardCompleted:!1};var pe=require("obsidian");var nn=require("obsidian");var A=class{constructor(t,n,i,r,a,o){this.app=t,this.containerEl=n,this.state=i,this.onNext=r,this.onBack=a,this.onCancel=o}};var de=class extends A{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Welcome to Vault CMS Setup"}),t.createEl("p",{text:"This wizard will help you configure your Vault CMS setup. We'll guide you through:"});let n=t.createEl("ul");n.createEl("li",{text:"Detecting your Astro project structure"}),n.createEl("li",{text:"Identifying your content types"}),n.createEl("li",{text:"Mapping frontmatter properties"}),n.createEl("li",{text:"Configuring plugins and themes"}),n.createEl("li",{text:"Setting up Bases CMS views"}),n.createEl("li",{text:"Configuring Astro Composer and SEO plugins"}),t.createEl("p",{text:'Click "Next" to begin the setup process.'})}validate(){return!0}getTitle(){return"Welcome"}getDescription(){return"Introduction to Vault CMS setup"}};var z=require("obsidian"),P=q(require("path")),K=q(require("fs"));var E=q(require("path")),R=q(require("fs")),ue=class{constructor(t){this.app=t}async detectProject(){let n=this.app.vault.adapter,i=n.basePath||n.path;if(!i)return null;let r=await this.searchUpwardForConfig(i);if(!r)return null;let a=this.detectVaultLocation(i,r.projectRoot);return{projectRoot:r.projectRoot,configFilePath:r.configFilePath,vaultLocation:a}}async searchUpwardForConfig(t){let n=["astro.config.mjs","astro.config.ts","astro.config.js","astro.config.mts","astro.config.cjs"],i="src/config.ts",r=E.resolve(t),a=E.parse(r).root;for(;r!==a;){for(let l of n){let c=E.join(r,l);try{if(R.existsSync(c)&&R.statSync(c).isFile())return{projectRoot:r,configFilePath:c}}catch(p){}}let o=E.join(r,i);try{R.existsSync(o)&&R.statSync(o).isFile()}catch(l){}let s=E.dirname(r);if(s===r)break;r=s}for(r=E.resolve(t);r!==a;){let o=E.join(r,i);try{if(R.existsSync(o)&&R.statSync(o).isFile())return{projectRoot:r,configFilePath:o}}catch(l){}let s=E.dirname(r);if(s===r)break;r=s}return null}detectVaultLocation(t,n){let i=E.normalize(t),r=E.normalize(n);if(!i.startsWith(r))return"root";let o=E.relative(r,i).split(E.sep).filter(c=>c.length>0),s=o.findIndex(c=>c.toLowerCase()==="content");if(s>0){let c=s-1;if(c>=0&&o[c].toLowerCase()==="src")return"content"}let l=o.findIndex(c=>c.toLowerCase()==="src");return l>=0&&l<o.length-1&&o[l+1].toLowerCase()==="content"?"nested-content":"root"}};var ge=class extends A{constructor(n,i,r,a,o,s){super(n,i,r,a,o,s);this.detected=!1;this.projectRootDisplay=null;this.configFileDisplay=null;this.projectDetector=new ue(n)}async display(){var r,a;let{containerEl:n}=this;n.empty();let i=((r=this.state.projectDetection)==null?void 0:r.projectRoot)&&((a=this.state.projectDetection)==null?void 0:a.configFilePath);if(i)this.detected=!0;else{n.createEl("h2",{text:"Project Detection"}),n.createEl("p",{text:"Detecting your Astro project structure..."});let o=await this.projectDetector.detectProject();if(o){let s=this.toRelativePath(o.projectRoot),l=this.toRelativePath(o.configFilePath);this.state.projectDetection={projectRoot:s,configFilePath:l,vaultLocation:o.vaultLocation},this.detected=!0}else this.detected=!1}if(this.state.projectDetection&&(this.detected||i)){await new Promise(l=>setTimeout(l,500)),n.empty(),n.createEl("h2",{text:"Project Detected"}),n.createEl("p",{text:'Project structure detected successfully. You can modify the paths below if needed, then click "Next" to continue.'});let o=new z.Setting(n).setName("Project Root").setDesc("Select the folder containing your Astro project root");this.projectRootDisplay=o.descEl.createDiv({text:this.state.projectDetection.projectRoot||"No folder selected",cls:"vault-cms-path-display"}),this.projectRootDisplay.style.color="var(--text-normal)",o.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{let c=await this.selectFolder();c&&(this.state.projectDetection.projectRoot=c,this.projectRootDisplay&&(this.projectRootDisplay.textContent=c,this.projectRootDisplay.style.color="var(--text-normal)"),this.detected=!1)}));let s=new z.Setting(n).setName("Config File").setDesc("Select your Astro config file (astro.config.mjs, astro.config.js, src/config.ts, etc.)");this.configFileDisplay=s.descEl.createDiv({text:this.state.projectDetection.configFilePath||"No file selected",cls:"vault-cms-path-display"}),this.configFileDisplay.style.color="var(--text-normal)",s.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{var f;let c=((f=this.state.projectDetection)==null?void 0:f.projectRoot)||this.getVaultPath(),p=await this.selectConfigFile(c);p&&(this.state.projectDetection.configFilePath=p,this.configFileDisplay&&(this.configFileDisplay.textContent=p,this.configFileDisplay.style.color="var(--text-normal)"),this.detected=!1)}))}else{n.empty(),n.createEl("h2",{text:"Project Detection Failed"}),n.createEl("p",{text:"Could not detect Astro project structure. Please select your Astro project root and config file manually."}),this.state.projectDetection||(this.state.projectDetection={projectRoot:"",configFilePath:"",vaultLocation:"root"});let o=new z.Setting(n).setName("Project Root").setDesc("Select the folder containing your Astro project root");this.projectRootDisplay=o.descEl.createDiv({text:this.state.projectDetection.projectRoot||"No folder selected",cls:"vault-cms-path-display"}),this.state.projectDetection.projectRoot?this.projectRootDisplay.style.color="var(--text-normal)":this.projectRootDisplay.style.color="var(--text-muted)",o.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{let c=await this.selectFolder();c&&(this.state.projectDetection.projectRoot=c,this.projectRootDisplay&&(this.projectRootDisplay.textContent=c,this.projectRootDisplay.style.color="var(--text-normal)"))}));let s=new z.Setting(n).setName("Config File").setDesc("Select your Astro config file (astro.config.mjs, astro.config.js, src/config.ts, etc.)");this.configFileDisplay=s.descEl.createDiv({text:this.state.projectDetection.configFilePath||"No file selected",cls:"vault-cms-path-display"}),this.state.projectDetection.configFilePath?this.configFileDisplay.style.color="var(--text-normal)":this.configFileDisplay.style.color="var(--text-muted)",s.addButton(l=>l.setButtonText("Browse...").setCta().onClick(async()=>{var f;let c=((f=this.state.projectDetection)==null?void 0:f.projectRoot)||this.getVaultPath(),p=await this.selectConfigFile(c);p&&(this.state.projectDetection.configFilePath=p,this.configFileDisplay&&(this.configFileDisplay.textContent=p,this.configFileDisplay.style.color="var(--text-normal)"))}))}}async selectFolder(){var n,i,r;try{let a=null;try{let c=require("@electron/remote");a=c==null?void 0:c.dialog}catch(c){}if(!a)try{let c=((n=window.require)==null?void 0:n.call(window,"electron"))||require("electron");a=(i=c==null?void 0:c.remote)==null?void 0:i.dialog}catch(c){}if(!a)try{let c=require("electron");a=c==null?void 0:c.dialog}catch(c){}if(!a||typeof a.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let o=this.getVaultPath(),s=((r=this.state.projectDetection)==null?void 0:r.projectRoot)||o;s&&!P.isAbsolute(s)&&(s=P.resolve(o,s));let l=a.showOpenDialogSync({title:"Select Astro Project Root Folder",defaultPath:s,properties:["openDirectory"]});if(l&&l.length>0){let c=P.normalize(l[0]);return this.toRelativePath(c)}}catch(a){console.error("Error opening folder picker:",a),new z.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}async selectConfigFile(n){var i,r,a;try{let o=null;try{let p=require("@electron/remote");o=p==null?void 0:p.dialog}catch(p){}if(!o)try{let p=((i=window.require)==null?void 0:i.call(window,"electron"))||require("electron");o=(r=p==null?void 0:p.remote)==null?void 0:r.dialog}catch(p){}if(!o)try{let p=require("electron");o=p==null?void 0:p.dialog}catch(p){}if(!o||typeof o.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let s=this.getVaultPath(),l=n||s;if(!n&&((a=this.state.projectDetection)!=null&&a.configFilePath)){let p=this.state.projectDetection.configFilePath;P.isAbsolute(p)?l=P.dirname(p):l=P.dirname(P.resolve(s,p))}else n&&!P.isAbsolute(n)?(l=P.resolve(s,n),P.extname(l)&&(l=P.dirname(l))):n&&P.isAbsolute(n)&&(P.extname(n)?l=P.dirname(n):l=n);let c=o.showOpenDialogSync({title:"Select Astro Config File",defaultPath:l,filters:[{name:"Astro Config Files",extensions:["ts","mjs","js","mts","cjs"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});if(c&&c.length>0){let p=P.normalize(c[0]);return this.toRelativePath(p)}}catch(o){console.error("Error opening file picker:",o),new z.Notice("Unable to open file picker. Please ensure you are using Obsidian on desktop.")}return null}getVaultPath(){let n=this.app.vault.adapter,i=n.basePath||n.path;return i?P.resolve(i):process.cwd()}toRelativePath(n){let i=this.app.vault.adapter,r=i.basePath||i.path;if(!r)return n;let a=P.normalize(r),o=P.normalize(n);if(o.startsWith(a)){let s=o.slice(a.length);return s.startsWith(P.sep)?s.slice(1):s}try{return P.relative(a,o).split(P.sep).join("/")}catch(s){return n}}validate(){var r,a;if(this.detected)return!0;let n=(r=this.state.projectDetection)==null?void 0:r.projectRoot,i=(a=this.state.projectDetection)==null?void 0:a.configFilePath;if(!n||!i)return!1;try{let o=this.getVaultPath(),s=P.isAbsolute(n)?n:P.join(o,n),l=P.isAbsolute(i)?i:P.join(o,i);return!(!K.existsSync(s)||!K.statSync(s).isDirectory()||!K.existsSync(l)||!K.statSync(l).isFile())}catch(o){return!1}}getTitle(){return"Project Detection"}getDescription(){return"Detect Astro project structure"}};var I=require("obsidian"),Q=q(require("path"));var He=require("obsidian"),me=class{constructor(t){this.app=t}async detectContentTypes(){let n=this.app.vault.getRoot();if(!(n instanceof He.TFolder))return[];let i=[],r=this.getTopLevelFolders(n);for(let a of r){let o=this.detectContentType(a);o&&i.push(o)}return i}getTopLevelFolders(t){let n=[];if(!t.children)return n;for(let i of t.children)i instanceof He.TFolder&&!i.name.startsWith(".")&&i.name!=="bases"&&i.name!=="_bases"&&i.name!=="node_modules"&&i.name!==".obsidian"&&n.push(i);return n}detectContentType(t){let n=t.name.toLowerCase(),i;return n==="posts"||n==="post"||n==="blog"?i="Posts":n==="pages"||n==="page"?i="Pages":i=this.capitalizeFirst(t.name),{id:`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:i,folder:t.name,fileOrganization:"file",enabled:!0,indexFileName:"index"}}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}};var Ve=require("obsidian"),V=q(require("path")),J=class{constructor(t){this.app=t}async configureAstroComposer(t,n,i,r,a){let o={customContentTypes:[],defaultTemplate:"",configFilePath:this.relativePath(r),terminalProjectRootPath:this.relativePath(i)},s=t.find(f=>f.name==="Posts"&&f.enabled),l=t.find(f=>f.name==="Pages"&&f.enabled);if(s){let f=n[s.id];o.postsFolder=s.folder,o.postsCreationMode=s.fileOrganization,o.postsIndexFileName=s.indexFileName||"index",o.defaultTemplate=(f==null?void 0:f.template)||this.generateTemplate(f,!0)}if(l){let f=n[l.id];o.enablePages=!0,o.pagesFolder=l.folder,o.pagesCreationMode=l.fileOrganization,o.pagesIndexFileName=l.indexFileName||"index",o.pageTemplate=(f==null?void 0:f.template)||this.generateTemplate(f,!1)}let c=a?t.find(f=>f.id===a&&f.enabled):null,p=t.filter(f=>f.enabled&&(!a||f.id!==a));if(c){let f=n[c.id],u=c.linkBasePath;(u===void 0||u==="")&&(u=`/${c.folder}/`),o.customContentTypes.push({id:c.id,name:c.name,folder:c.folder,template:(f==null?void 0:f.template)||this.generateTemplate(f,c.name==="Posts"||c.name==="Pages"),enabled:!0,linkBasePath:u,creationMode:c.fileOrganization,indexFileName:c.indexFileName||"index"})}for(let f of p){let u=n[f.id],d=f.linkBasePath;(d===void 0||d==="")&&(d=`/${f.folder}/`),o.customContentTypes.push({id:f.id,name:f.name,folder:f.folder,template:(u==null?void 0:u.template)||this.generateTemplate(u,f.name==="Posts"||f.name==="Pages"),enabled:!0,linkBasePath:d,creationMode:f.fileOrganization,indexFileName:f.indexFileName||"index"})}return o}generateTemplate(t,n){if(t!=null&&t.template)return t.template;if(!t)return`---
title: "{{title}}"
---
`;let i=`---
`;return i+=`${t.titleProperty}: "{{title}}"
`,n&&(i+=`${t.dateProperty}: {{date}}
`),t.descriptionProperty&&(i+=`${t.descriptionProperty}: ""
`),i+=`tags: []
`,i+=`draft: true
`,i+=`---
`,i}getCreationModeFromAttachmentHandling(t){return t==="same-folder"?"folder":"file"}relativePath(t){if(!V.isAbsolute(t))return t;let n=this.app.vault.adapter,i=n.basePath||n.path;if(!i)return t;let r=V.normalize(i),a=V.normalize(t);if(a.startsWith(r)){let o=a.slice(r.length);return o.startsWith(V.sep)?o.slice(1):o}return t}async saveConfig(t){var n;try{let i=this.app.plugins,r=(n=i==null?void 0:i.plugins)==null?void 0:n["astro-composer"];if(!r){console.warn("AstroComposerConfig: Astro Composer plugin not found, using fallback file method"),await this.saveConfigFallback(t);return}if(!r.settings){console.warn("AstroComposerConfig: Astro Composer plugin settings not available, using fallback file method"),await this.saveConfigFallback(t);return}let a=r.settings;t.defaultTemplate&&(a.defaultTemplate=t.defaultTemplate),t.pageTemplate&&(a.pageTemplate=t.pageTemplate),t.postsFolder&&(a.postsFolder=t.postsFolder),t.postsCreationMode&&(a.creationMode=t.postsCreationMode),t.postsIndexFileName&&(a.indexFileName=t.postsIndexFileName),t.enablePages!==void 0&&(a.enablePages=t.enablePages),t.pagesFolder&&(a.pagesFolder=t.pagesFolder),t.pagesCreationMode&&(a.pagesCreationMode=t.pagesCreationMode),t.pagesIndexFileName&&(a.pagesIndexFileName=t.pagesIndexFileName),t.configFilePath&&(a.configFilePath=t.configFilePath),t.terminalProjectRootPath&&(a.terminalProjectRootPath=t.terminalProjectRootPath),Array.isArray(a.contentTypes)||(a.contentTypes=[]);for(let o of t.customContentTypes){let s=a.contentTypes.findIndex(l=>l.name===o.name&&l.folder===o.folder);s>=0?a.contentTypes[s]={...a.contentTypes[s],name:o.name,folder:o.folder,linkBasePath:o.linkBasePath,template:o.template,enabled:o.enabled,creationMode:o.creationMode,indexFileName:o.indexFileName}:a.contentTypes.push({id:o.id,name:o.name,folder:o.folder,linkBasePath:o.linkBasePath,template:o.template,enabled:o.enabled,creationMode:o.creationMode,indexFileName:o.indexFileName,ignoreSubfolders:!1,enableUnderscorePrefix:!1})}a.customContentTypes=this.mergeCustomContentTypes(a.customContentTypes||[],t.customContentTypes||[]),typeof r.saveSettings=="function"?(await r.saveSettings(),console.log("AstroComposerConfig: Successfully saved via plugin.saveSettings()")):(console.warn("AstroComposerConfig: Plugin saveSettings not available, using fallback"),await this.saveConfigFallback(t))}catch(i){console.error("Failed to save Astro Composer config via plugin method:",i),await this.saveConfigFallback(t)}}async saveConfigFallback(t){let n="astro-composer",i=`.obsidian/plugins/${n}/data.json`,r={},a=this.app.vault.getAbstractFileByPath(i);if(a&&a instanceof Ve.TFile)try{r=JSON.parse(await this.app.vault.read(a))}catch(o){console.warn("Failed to parse existing Astro Composer data.json, starting fresh:",o),r={}}t.defaultTemplate&&(r.defaultTemplate=t.defaultTemplate),t.pageTemplate&&(r.pageTemplate=t.pageTemplate),t.postsFolder&&(r.postsFolder=t.postsFolder),t.postsCreationMode&&(r.creationMode=t.postsCreationMode),t.postsIndexFileName&&(r.indexFileName=t.postsIndexFileName),t.enablePages!==void 0&&(r.enablePages=t.enablePages),t.pagesFolder&&(r.pagesFolder=t.pagesFolder),t.pagesCreationMode&&(r.pagesCreationMode=t.pagesCreationMode),t.pagesIndexFileName&&(r.pagesIndexFileName=t.pagesIndexFileName),t.configFilePath&&(r.configFilePath=t.configFilePath),t.terminalProjectRootPath&&(r.terminalProjectRootPath=t.terminalProjectRootPath),Array.isArray(r.contentTypes)||(r.contentTypes=[]);for(let o of t.customContentTypes){let s=r.contentTypes.findIndex(l=>l.name===o.name&&l.folder===o.folder);s>=0?r.contentTypes[s]={...r.contentTypes[s],name:o.name,folder:o.folder,linkBasePath:o.linkBasePath,template:o.template,enabled:o.enabled,creationMode:o.creationMode,indexFileName:o.indexFileName}:r.contentTypes.push({id:o.id,name:o.name,folder:o.folder,linkBasePath:o.linkBasePath,template:o.template,enabled:o.enabled,creationMode:o.creationMode,indexFileName:o.indexFileName,ignoreSubfolders:!1,enableUnderscorePrefix:!1})}if(r.customContentTypes=this.mergeCustomContentTypes(r.customContentTypes||[],t.customContentTypes||[]),a&&a instanceof Ve.TFile)await this.app.vault.modify(a,JSON.stringify(r,null,2));else{let o=`.obsidian/plugins/${n}`;this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o),await this.app.vault.create(i,JSON.stringify(r,null,2))}}mergeCustomContentTypes(t,n){let i=[...t];for(let r of n){let a=i.findIndex(o=>o.id===r.id);a>=0?i[a]={...i[a],...r}:i.push(r)}return i}};var Ue=class extends I.AbstractInputSuggest{constructor(n,i,r){super(n,i);this.inputEl=i,this.mode=r}getSuggestions(n){let i=[],r=n.toLowerCase();if(this.mode==="subfolder"){"attachments".toLowerCase().includes(r)&&i.push("attachments");let a=this.app.vault.getAllLoadedFiles(),o=new Set;for(let s of a)if(s instanceof I.TFolder){let l=s.name;l.toLowerCase().includes(r)&&l!=="attachments"&&o.add(l)}i.push(...Array.from(o).slice(0,10))}else{let a=this.app.vault.getAllLoadedFiles(),o=new Set;for(let s of a)if(s instanceof I.TFolder){let l=s.path;l.toLowerCase().includes(r)&&o.add(l)}i.push(...Array.from(o).slice(0,10))}return i}renderSuggestion(n,i){i.setText(n)}selectSuggestion(n){this.inputEl.value=n,this.inputEl.trigger("input"),this.close()}},he=class extends A{constructor(n,i,r,a,o,s){super(n,i,r,a,o,s);this.detected=!1;this.contentTypeDetector=new me(n),this.astroComposerConfigurator=new J(n)}async importFromAstroComposer(){var n;try{let i=this.app.plugins;if(console.log("ContentTypeStep: Checking plugins API:",!!i),i){let c=(n=i.plugins)==null?void 0:n["astro-composer"];if(console.log("ContentTypeStep: Astro Composer plugin found:",!!c),c&&(console.log("ContentTypeStep: Plugin settings available:",!!c.settings),console.log("ContentTypeStep: Plugin settings keys:",c.settings?Object.keys(c.settings):"none"),c.settings)){let p=c.settings.contentTypes;if(console.log("ContentTypeStep: contentTypes from plugin:",p?`Array with ${p.length} items`:"not found"),Array.isArray(p)&&p.length>0)return console.log("ContentTypeStep: Importing",p.length,"content types from Astro Composer (via plugin API)"),p.map(u=>({id:u.id||`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:u.name||this.capitalizeFirst(u.folder),folder:u.folder,fileOrganization:u.creationMode==="folder"?"folder":"file",indexFileName:u.indexFileName||"index",linkBasePath:u.linkBasePath,enabled:u.enabled!==!1}))}}let r=".obsidian/plugins/astro-composer/data.json";console.log("ContentTypeStep: Trying to read file:",r);let a=this.app.vault.getAbstractFileByPath(r);if(console.log("ContentTypeStep: File found:",!!a,a?`Type: ${a.constructor.name}`:"not found"),!a||!(a instanceof I.TFile)){let c=[".obsidian/plugins/astro-composer/data.json","obsidian/plugins/astro-composer/data.json",".obsidian/plugins/astro-composer/data.json"];for(let p of c){let f=this.app.vault.getAbstractFileByPath(p);if(f&&f instanceof I.TFile){console.log("ContentTypeStep: Found file at alternative path:",p);let u=await this.app.vault.read(f),d=JSON.parse(u);if(d.contentTypes&&Array.isArray(d.contentTypes))return console.log("ContentTypeStep: Importing",d.contentTypes.length,"content types from Astro Composer (via file at",p,")"),d.contentTypes.map(h=>({id:h.id||`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:h.name||this.capitalizeFirst(h.folder),folder:h.folder,fileOrganization:h.creationMode==="folder"?"folder":"file",indexFileName:h.indexFileName||"index",linkBasePath:h.linkBasePath,enabled:h.enabled!==!1}))}}return console.log("ContentTypeStep: No Astro Composer data.json found, will scan folders"),[]}let o=await this.app.vault.read(a),s=JSON.parse(o);return!s.contentTypes||!Array.isArray(s.contentTypes)?(console.log("ContentTypeStep: Astro Composer data.json has no contentTypes array. Data keys:",Object.keys(s)),[]):(console.log("ContentTypeStep: Importing",s.contentTypes.length,"content types from Astro Composer (via file)"),s.contentTypes.map(c=>({id:c.id||`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:c.name||this.capitalizeFirst(c.folder),folder:c.folder,fileOrganization:c.creationMode==="folder"?"folder":"file",indexFileName:c.indexFileName||"index",linkBasePath:c.linkBasePath,enabled:c.enabled!==!1})))}catch(i){return console.error("ContentTypeStep: Failed to import from Astro Composer:",i),[]}}async display(){let{containerEl:n}=this,i=n.querySelector(".content-type-step-content");if(i?i.empty():(n.empty(),i=n.createDiv({cls:"content-type-step-content"})),i.createEl("h2",{text:"Content Types"}),i.createEl("p",{text:"Detecting content types in your vault..."}),!this.detected){let a=await this.importFromAstroComposer(),o=await this.contentTypeDetector.detectContentTypes(),s=new Set(a.map(p=>p.folder)),l=o.filter(p=>!s.has(p.folder)),c=[...a,...l];c.sort((p,f)=>p.name.localeCompare(f.name)),this.state.contentTypes=c,this.detected=!0}if(i.empty(),i.createEl("h2",{text:"Content Types"}),i.createEl("p",{text:"Select and configure your content types:"}),i.createEl("h3",{text:"Attachment Handling",cls:"vault-cms-section-header"}),i.createEl("p",{text:"How should attachments be stored globally?",cls:"vault-cms-section-desc"}),new I.Setting(i).setName("How are attachments handled?").setDesc("Choose how attachments are stored for all content types").addDropdown(a=>a.addOption("same-folder","Same folder as current file").addOption("specified-folder","In the specified folder").addOption("subfolder","In subfolder under current folder").setValue(this.state.attachmentHandlingMode||"subfolder").onChange(o=>{this.state.attachmentHandlingMode=o,o==="same-folder"&&(this.state.attachmentFolderName=void 0),this.display()})),this.state.attachmentHandlingMode==="specified-folder"||this.state.attachmentHandlingMode==="subfolder"){let a=this.state.attachmentHandlingMode==="specified-folder"?'Enter the exact path to the folder for attachments (e.g., "attachments" or "images/attachments"). Leave blank to use "attachments" as default.':'Enter the name of the subfolder for attachments (e.g., "attachments"). Leave blank to use "attachments" as default.';new I.Setting(i).setName("Attachment Folder").setDesc(a).addText(s=>{s.setPlaceholder("attachments").setValue(this.state.attachmentFolderName||"").onChange(l=>{this.state.attachmentFolderName=l||void 0}),this.state.attachmentHandlingMode!=="same-folder"&&new Ue(this.app,s.inputEl,this.state.attachmentHandlingMode)})}i.createEl("hr",{cls:"vault-cms-divider"}),i.createEl("h3",{text:"Content Types",cls:"vault-cms-section-header"});for(let a of this.state.contentTypes){let o=new I.Setting(i).setName(a.name).setDesc(`Folder: ${a.folder}`).addToggle(l=>l.setValue(a.enabled).onChange(c=>{a.enabled=c}));new I.Setting(i).setName(`${a.name} - File Organization`).setDesc("Choose how content is organized for this content type").addDropdown(l=>l.addOption("file","File-based").addOption("folder","Folder-based").setValue(a.fileOrganization||"file").onChange(c=>{a.fileOrganization=c,this.display()})),a.fileOrganization==="folder"&&new I.Setting(i).setName(`${a.name} - Index File Name`).setDesc("Name of the index file in folder-based organization").addText(l=>l.setValue(a.indexFileName||"index").onChange(c=>{a.indexFileName=c||"index"}));let s=`/${a.folder}/`;new I.Setting(i).setName(`${a.name} - Link Base Path`).setDesc(`URL path for this content type (e.g., "/posts/" or "/" for root). Leave blank to use default: ${s}`).addText(l=>l.setPlaceholder(s).setValue(a.linkBasePath||"").onChange(c=>{a.linkBasePath=c||void 0}))}let r=i.createEl("button",{text:"Add Additional Content Type",cls:"mod-cta"});r.style.marginTop="20px",r.style.marginBottom="30px",r.addEventListener("click",async()=>{let a=await this.selectContentTypeFolder();if(a){let o=Q.basename(a),s={id:`content-type-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:this.capitalizeFirst(o),folder:o,fileOrganization:"file",enabled:!1,indexFileName:"index"};this.state.contentTypes.push(s),this.display()}})}async selectContentTypeFolder(){var n,i;try{let r=null;try{let s=require("@electron/remote");r=s==null?void 0:s.dialog}catch(s){}if(!r)try{let s=((n=window.require)==null?void 0:n.call(window,"electron"))||require("electron");r=(i=s==null?void 0:s.remote)==null?void 0:i.dialog}catch(s){}if(!r)try{let s=require("electron");r=s==null?void 0:s.dialog}catch(s){}if(!r||typeof r.showOpenDialogSync!="function")throw new Error("Electron dialog API not available");let a=this.getVaultPath(),o=r.showOpenDialogSync({title:"Select Content Type Folder",defaultPath:a,properties:["openDirectory"]});if(o&&o.length>0)return Q.normalize(o[0])}catch(r){console.error("Error opening folder picker:",r),new I.Notice("Unable to open folder picker. Please ensure you are using Obsidian on desktop.")}return null}getVaultPath(){let n=this.app.vault.adapter,i=n.basePath||n.path;return i?Q.resolve(i):process.cwd()}capitalizeFirst(n){return n.charAt(0).toUpperCase()+n.slice(1)}validate(){return this.state.contentTypes.some(n=>n.enabled)}getTitle(){return"Content Types"}getDescription(){return"Configure content types"}};var ft=require("obsidian");var ye=class extends A{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Default Content Type"}),t.createEl("p",{text:"Select which content type should be used as the default. This will:"});let n=t.createEl("ul");n.createEl("li",{text:"Set as the default Bases CMS view"}),n.createEl("li",{text:`Configure Obsidian's "Default location for new notes" to that folder`});let i=this.state.contentTypes.filter(a=>a.enabled);if(i.length===0){t.createEl("p",{text:"No enabled content types found. Please go back and enable at least one content type."});return}(!this.state.defaultContentTypeId||i.findIndex(a=>a.id===this.state.defaultContentTypeId)===-1)&&(this.state.defaultContentTypeId=i[0].id);let r=this.state.defaultContentTypeId;new ft.Setting(t).setName("Default Content Type").setDesc("Choose the default content type for new notes").addDropdown(a=>{i.forEach(o=>{a.addOption(o.id,o.name)}),a.setValue(r),a.onChange(o=>{this.state.defaultContentTypeId=o})})}validate(){return!!this.state.defaultContentTypeId}getTitle(){return"Default Content Type"}getDescription(){return"Select default content type"}};var N=require("obsidian");var at=require("obsidian");function St(e){return typeof e=="undefined"||e===null}function gn(e){return typeof e=="object"&&e!==null}function mn(e){return Array.isArray(e)?e:St(e)?[]:[e]}function hn(e,t){var n,i,r,a;if(t)for(a=Object.keys(t),n=0,i=a.length;n<i;n+=1)r=a[n],e[r]=t[r];return e}function yn(e,t){var n="",i;for(i=0;i<t;i+=1)n+=e;return n}function Cn(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var vn=St,bn=gn,xn=mn,Pn=yn,wn=Cn,Fn=hn,D={isNothing:vn,isObject:bn,toArray:xn,repeat:Pn,isNegativeZero:wn,extend:Fn};function Et(e,t){var n="",i=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+=`

`+e.mark.snippet),i+" "+n):i}function ie(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=Et(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}ie.prototype=Object.create(Error.prototype);ie.prototype.constructor=ie;ie.prototype.toString=function(t){return this.name+": "+Et(this,t)};var j=ie;function Ge(e,t,n,i,r){var a="",o="",s=Math.floor(r/2)-1;return i-t>s&&(a=" ... ",t=i-s+a.length),n-i>s&&(o=" ...",n=i+s-o.length),{str:a+e.slice(t,n).replace(/\t/g,"\u2192")+o,pos:i-t+a.length}}function qe(e,t){return D.repeat(" ",t-e.length)+e}function An(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),typeof t.indent!="number"&&(t.indent=1),typeof t.linesBefore!="number"&&(t.linesBefore=3),typeof t.linesAfter!="number"&&(t.linesAfter=2);for(var n=/\r?\n|\r|\0/g,i=[0],r=[],a,o=-1;a=n.exec(e.buffer);)r.push(a.index),i.push(a.index+a[0].length),e.position<=a.index&&o<0&&(o=i.length-2);o<0&&(o=i.length-1);var s="",l,c,p=Math.min(e.line+t.linesAfter,r.length).toString().length,f=t.maxLength-(t.indent+p+3);for(l=1;l<=t.linesBefore&&!(o-l<0);l++)c=Ge(e.buffer,i[o-l],r[o-l],e.position-(i[o]-i[o-l]),f),s=D.repeat(" ",t.indent)+qe((e.line-l+1).toString(),p)+" | "+c.str+`
`+s;for(c=Ge(e.buffer,i[o],r[o],e.position,f),s+=D.repeat(" ",t.indent)+qe((e.line+1).toString(),p)+" | "+c.str+`
`,s+=D.repeat("-",t.indent+p+3+c.pos)+`^
`,l=1;l<=t.linesAfter&&!(o+l>=r.length);l++)c=Ge(e.buffer,i[o+l],r[o+l],e.position-(i[o]-i[o+l]),f),s+=D.repeat(" ",t.indent)+qe((e.line+l+1).toString(),p)+" | "+c.str+`
`;return s.replace(/\n$/,"")}var Tn=An,Sn=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],En=["scalar","sequence","mapping"];function Dn(e){var t={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(i){t[String(i)]=n})}),t}function Nn(e,t){if(t=t||{},Object.keys(t).forEach(function(n){if(Sn.indexOf(n)===-1)throw new j('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(n){return n},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=Dn(t.styleAliases||null),En.indexOf(this.kind)===-1)throw new j('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var k=Nn;function dt(e,t){var n=[];return e[t].forEach(function(i){var r=n.length;n.forEach(function(a,o){a.tag===i.tag&&a.kind===i.kind&&a.multi===i.multi&&(r=o)}),n[r]=i}),n}function On(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},t,n;function i(r){r.multi?(e.multi[r.kind].push(r),e.multi.fallback.push(r)):e[r.kind][r.tag]=e.fallback[r.tag]=r}for(t=0,n=arguments.length;t<n;t+=1)arguments[t].forEach(i);return e}function Je(e){return this.extend(e)}Je.prototype.extend=function(t){var n=[],i=[];if(t instanceof k)i.push(t);else if(Array.isArray(t))i=i.concat(t);else if(t&&(Array.isArray(t.implicit)||Array.isArray(t.explicit)))t.implicit&&(n=n.concat(t.implicit)),t.explicit&&(i=i.concat(t.explicit));else throw new j("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(a){if(!(a instanceof k))throw new j("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(a.loadKind&&a.loadKind!=="scalar")throw new j("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(a.multi)throw new j("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),i.forEach(function(a){if(!(a instanceof k))throw new j("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var r=Object.create(Je.prototype);return r.implicit=(this.implicit||[]).concat(n),r.explicit=(this.explicit||[]).concat(i),r.compiledImplicit=dt(r,"implicit"),r.compiledExplicit=dt(r,"explicit"),r.compiledTypeMap=On(r.compiledImplicit,r.compiledExplicit),r};var In=Je,kn=new k("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Mn=new k("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),jn=new k("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Ln=new In({explicit:[kn,Mn,jn]});function _n(e){if(e===null)return!0;var t=e.length;return t===1&&e==="~"||t===4&&(e==="null"||e==="Null"||e==="NULL")}function Bn(){return null}function $n(e){return e===null}var Rn=new k("tag:yaml.org,2002:null",{kind:"scalar",resolve:_n,construct:Bn,predicate:$n,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function zn(e){if(e===null)return!1;var t=e.length;return t===4&&(e==="true"||e==="True"||e==="TRUE")||t===5&&(e==="false"||e==="False"||e==="FALSE")}function Wn(e){return e==="true"||e==="True"||e==="TRUE"}function Yn(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Hn=new k("tag:yaml.org,2002:bool",{kind:"scalar",resolve:zn,construct:Wn,predicate:Yn,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function Vn(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function Un(e){return 48<=e&&e<=55}function Gn(e){return 48<=e&&e<=57}function qn(e){if(e===null)return!1;var t=e.length,n=0,i=!1,r;if(!t)return!1;if(r=e[n],(r==="-"||r==="+")&&(r=e[++n]),r==="0"){if(n+1===t)return!0;if(r=e[++n],r==="b"){for(n++;n<t;n++)if(r=e[n],r!=="_"){if(r!=="0"&&r!=="1")return!1;i=!0}return i&&r!=="_"}if(r==="x"){for(n++;n<t;n++)if(r=e[n],r!=="_"){if(!Vn(e.charCodeAt(n)))return!1;i=!0}return i&&r!=="_"}if(r==="o"){for(n++;n<t;n++)if(r=e[n],r!=="_"){if(!Un(e.charCodeAt(n)))return!1;i=!0}return i&&r!=="_"}}if(r==="_")return!1;for(;n<t;n++)if(r=e[n],r!=="_"){if(!Gn(e.charCodeAt(n)))return!1;i=!0}return!(!i||r==="_")}function Kn(e){var t=e,n=1,i;if(t.indexOf("_")!==-1&&(t=t.replace(/_/g,"")),i=t[0],(i==="-"||i==="+")&&(i==="-"&&(n=-1),t=t.slice(1),i=t[0]),t==="0")return 0;if(i==="0"){if(t[1]==="b")return n*parseInt(t.slice(2),2);if(t[1]==="x")return n*parseInt(t.slice(2),16);if(t[1]==="o")return n*parseInt(t.slice(2),8)}return n*parseInt(t,10)}function Jn(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!D.isNegativeZero(e)}var Qn=new k("tag:yaml.org,2002:int",{kind:"scalar",resolve:qn,construct:Kn,predicate:Jn,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Xn=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function Zn(e){return!(e===null||!Xn.test(e)||e[e.length-1]==="_")}function er(e){var t,n;return t=e.replace(/_/g,"").toLowerCase(),n=t[0]==="-"?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),t===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:n*parseFloat(t,10)}var tr=/^[-+]?[0-9]+e/;function nr(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(D.isNegativeZero(e))return"-0.0";return n=e.toString(10),tr.test(n)?n.replace("e",".e"):n}function rr(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||D.isNegativeZero(e))}var ir=new k("tag:yaml.org,2002:float",{kind:"scalar",resolve:Zn,construct:er,predicate:rr,represent:nr,defaultStyle:"lowercase"}),or=Ln.extend({implicit:[Rn,Hn,Qn,ir]}),ar=or,Dt=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Nt=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function sr(e){return e===null?!1:Dt.exec(e)!==null||Nt.exec(e)!==null}function lr(e){var t,n,i,r,a,o,s,l=0,c=null,p,f,u;if(t=Dt.exec(e),t===null&&(t=Nt.exec(e)),t===null)throw new Error("Date resolve error");if(n=+t[1],i=+t[2]-1,r=+t[3],!t[4])return new Date(Date.UTC(n,i,r));if(a=+t[4],o=+t[5],s=+t[6],t[7]){for(l=t[7].slice(0,3);l.length<3;)l+="0";l=+l}return t[9]&&(p=+t[10],f=+(t[11]||0),c=(p*60+f)*6e4,t[9]==="-"&&(c=-c)),u=new Date(Date.UTC(n,i,r,a,o,s,l)),c&&u.setTime(u.getTime()-c),u}function cr(e){return e.toISOString()}var pr=new k("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:sr,construct:lr,instanceOf:Date,represent:cr});function fr(e){return e==="<<"||e===null}var dr=new k("tag:yaml.org,2002:merge",{kind:"scalar",resolve:fr}),tt=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function ur(e){if(e===null)return!1;var t,n,i=0,r=e.length,a=tt;for(n=0;n<r;n++)if(t=a.indexOf(e.charAt(n)),!(t>64)){if(t<0)return!1;i+=6}return i%8===0}function gr(e){var t,n,i=e.replace(/[\r\n=]/g,""),r=i.length,a=tt,o=0,s=[];for(t=0;t<r;t++)t%4===0&&t&&(s.push(o>>16&255),s.push(o>>8&255),s.push(o&255)),o=o<<6|a.indexOf(i.charAt(t));return n=r%4*6,n===0?(s.push(o>>16&255),s.push(o>>8&255),s.push(o&255)):n===18?(s.push(o>>10&255),s.push(o>>2&255)):n===12&&s.push(o>>4&255),new Uint8Array(s)}function mr(e){var t="",n=0,i,r,a=e.length,o=tt;for(i=0;i<a;i++)i%3===0&&i&&(t+=o[n>>18&63],t+=o[n>>12&63],t+=o[n>>6&63],t+=o[n&63]),n=(n<<8)+e[i];return r=a%3,r===0?(t+=o[n>>18&63],t+=o[n>>12&63],t+=o[n>>6&63],t+=o[n&63]):r===2?(t+=o[n>>10&63],t+=o[n>>4&63],t+=o[n<<2&63],t+=o[64]):r===1&&(t+=o[n>>2&63],t+=o[n<<4&63],t+=o[64],t+=o[64]),t}function hr(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var yr=new k("tag:yaml.org,2002:binary",{kind:"scalar",resolve:ur,construct:gr,predicate:hr,represent:mr}),Cr=Object.prototype.hasOwnProperty,vr=Object.prototype.toString;function br(e){if(e===null)return!0;var t=[],n,i,r,a,o,s=e;for(n=0,i=s.length;n<i;n+=1){if(r=s[n],o=!1,vr.call(r)!=="[object Object]")return!1;for(a in r)if(Cr.call(r,a))if(!o)o=!0;else return!1;if(!o)return!1;if(t.indexOf(a)===-1)t.push(a);else return!1}return!0}function xr(e){return e!==null?e:[]}var Pr=new k("tag:yaml.org,2002:omap",{kind:"sequence",resolve:br,construct:xr}),wr=Object.prototype.toString;function Fr(e){if(e===null)return!0;var t,n,i,r,a,o=e;for(a=new Array(o.length),t=0,n=o.length;t<n;t+=1){if(i=o[t],wr.call(i)!=="[object Object]"||(r=Object.keys(i),r.length!==1))return!1;a[t]=[r[0],i[r[0]]]}return!0}function Ar(e){if(e===null)return[];var t,n,i,r,a,o=e;for(a=new Array(o.length),t=0,n=o.length;t<n;t+=1)i=o[t],r=Object.keys(i),a[t]=[r[0],i[r[0]]];return a}var Tr=new k("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Fr,construct:Ar}),Sr=Object.prototype.hasOwnProperty;function Er(e){if(e===null)return!0;var t,n=e;for(t in n)if(Sr.call(n,t)&&n[t]!==null)return!1;return!0}function Dr(e){return e!==null?e:{}}var Nr=new k("tag:yaml.org,2002:set",{kind:"mapping",resolve:Er,construct:Dr}),Ot=ar.extend({implicit:[pr,dr],explicit:[yr,Pr,Tr,Nr]}),Y=Object.prototype.hasOwnProperty,Ce=1,It=2,kt=3,ve=4,Ke=1,Or=2,ut=3,Ir=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,kr=/[\x85\u2028\u2029]/,Mr=/[,\[\]\{\}]/,Mt=/^(?:!|!!|![a-z\-]+!)$/i,jt=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function gt(e){return Object.prototype.toString.call(e)}function _(e){return e===10||e===13}function G(e){return e===9||e===32}function L(e){return e===9||e===32||e===10||e===13}function Z(e){return e===44||e===91||e===93||e===123||e===125}function jr(e){var t;return 48<=e&&e<=57?e-48:(t=e|32,97<=t&&t<=102?t-97+10:-1)}function Lr(e){return e===120?2:e===117?4:e===85?8:0}function _r(e){return 48<=e&&e<=57?e-48:-1}function mt(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Br(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function Lt(e,t,n){t==="__proto__"?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:n}):e[t]=n}var _t=new Array(256),Bt=new Array(256);for(U=0;U<256;U++)_t[U]=mt(U)?1:0,Bt[U]=mt(U);var U;function $r(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||Ot,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function $t(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=Tn(n),new j(t,n)}function y(e,t){throw $t(e,t)}function be(e,t){e.onWarning&&e.onWarning.call(null,$t(e,t))}var ht={YAML:function(t,n,i){var r,a,o;t.version!==null&&y(t,"duplication of %YAML directive"),i.length!==1&&y(t,"YAML directive accepts exactly one argument"),r=/^([0-9]+)\.([0-9]+)$/.exec(i[0]),r===null&&y(t,"ill-formed argument of the YAML directive"),a=parseInt(r[1],10),o=parseInt(r[2],10),a!==1&&y(t,"unacceptable YAML version of the document"),t.version=i[0],t.checkLineBreaks=o<2,o!==1&&o!==2&&be(t,"unsupported YAML version of the document")},TAG:function(t,n,i){var r,a;i.length!==2&&y(t,"TAG directive accepts exactly two arguments"),r=i[0],a=i[1],Mt.test(r)||y(t,"ill-formed tag handle (first argument) of the TAG directive"),Y.call(t.tagMap,r)&&y(t,'there is a previously declared suffix for "'+r+'" tag handle'),jt.test(a)||y(t,"ill-formed tag prefix (second argument) of the TAG directive");try{a=decodeURIComponent(a)}catch(o){y(t,"tag prefix is malformed: "+a)}t.tagMap[r]=a}};function W(e,t,n,i){var r,a,o,s;if(t<n){if(s=e.input.slice(t,n),i)for(r=0,a=s.length;r<a;r+=1)o=s.charCodeAt(r),o===9||32<=o&&o<=1114111||y(e,"expected valid JSON character");else Ir.test(s)&&y(e,"the stream contains non-printable characters");e.result+=s}}function yt(e,t,n,i){var r,a,o,s;for(D.isObject(n)||y(e,"cannot merge mappings; the provided source object is unacceptable"),r=Object.keys(n),o=0,s=r.length;o<s;o+=1)a=r[o],Y.call(t,a)||(Lt(t,a,n[a]),i[a]=!0)}function ee(e,t,n,i,r,a,o,s,l){var c,p;if(Array.isArray(r))for(r=Array.prototype.slice.call(r),c=0,p=r.length;c<p;c+=1)Array.isArray(r[c])&&y(e,"nested arrays are not supported inside keys"),typeof r=="object"&&gt(r[c])==="[object Object]"&&(r[c]="[object Object]");if(typeof r=="object"&&gt(r)==="[object Object]"&&(r="[object Object]"),r=String(r),t===null&&(t={}),i==="tag:yaml.org,2002:merge")if(Array.isArray(a))for(c=0,p=a.length;c<p;c+=1)yt(e,t,a[c],n);else yt(e,t,a,n);else!e.json&&!Y.call(n,r)&&Y.call(t,r)&&(e.line=o||e.line,e.lineStart=s||e.lineStart,e.position=l||e.position,y(e,"duplicated mapping key")),Lt(t,r,a),delete n[r];return t}function nt(e){var t;t=e.input.charCodeAt(e.position),t===10?e.position++:t===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):y(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function S(e,t,n){for(var i=0,r=e.input.charCodeAt(e.position);r!==0;){for(;G(r);)r===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),r=e.input.charCodeAt(++e.position);if(t&&r===35)do r=e.input.charCodeAt(++e.position);while(r!==10&&r!==13&&r!==0);if(_(r))for(nt(e),r=e.input.charCodeAt(e.position),i++,e.lineIndent=0;r===32;)e.lineIndent++,r=e.input.charCodeAt(++e.position);else break}return n!==-1&&i!==0&&e.lineIndent<n&&be(e,"deficient indentation"),i}function we(e){var t=e.position,n;return n=e.input.charCodeAt(t),!!((n===45||n===46)&&n===e.input.charCodeAt(t+1)&&n===e.input.charCodeAt(t+2)&&(t+=3,n=e.input.charCodeAt(t),n===0||L(n)))}function rt(e,t){t===1?e.result+=" ":t>1&&(e.result+=D.repeat(`
`,t-1))}function Rr(e,t,n){var i,r,a,o,s,l,c,p,f=e.kind,u=e.result,d;if(d=e.input.charCodeAt(e.position),L(d)||Z(d)||d===35||d===38||d===42||d===33||d===124||d===62||d===39||d===34||d===37||d===64||d===96||(d===63||d===45)&&(r=e.input.charCodeAt(e.position+1),L(r)||n&&Z(r)))return!1;for(e.kind="scalar",e.result="",a=o=e.position,s=!1;d!==0;){if(d===58){if(r=e.input.charCodeAt(e.position+1),L(r)||n&&Z(r))break}else if(d===35){if(i=e.input.charCodeAt(e.position-1),L(i))break}else{if(e.position===e.lineStart&&we(e)||n&&Z(d))break;if(_(d))if(l=e.line,c=e.lineStart,p=e.lineIndent,S(e,!1,-1),e.lineIndent>=t){s=!0,d=e.input.charCodeAt(e.position);continue}else{e.position=o,e.line=l,e.lineStart=c,e.lineIndent=p;break}}s&&(W(e,a,o,!1),rt(e,e.line-l),a=o=e.position,s=!1),G(d)||(o=e.position+1),d=e.input.charCodeAt(++e.position)}return W(e,a,o,!1),e.result?!0:(e.kind=f,e.result=u,!1)}function zr(e,t){var n,i,r;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,i=r=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(W(e,i,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)i=e.position,e.position++,r=e.position;else return!0;else _(n)?(W(e,i,r,!0),rt(e,S(e,!1,t)),i=r=e.position):e.position===e.lineStart&&we(e)?y(e,"unexpected end of the document within a single quoted scalar"):(e.position++,r=e.position);y(e,"unexpected end of the stream within a single quoted scalar")}function Wr(e,t){var n,i,r,a,o,s;if(s=e.input.charCodeAt(e.position),s!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=i=e.position;(s=e.input.charCodeAt(e.position))!==0;){if(s===34)return W(e,n,e.position,!0),e.position++,!0;if(s===92){if(W(e,n,e.position,!0),s=e.input.charCodeAt(++e.position),_(s))S(e,!1,t);else if(s<256&&_t[s])e.result+=Bt[s],e.position++;else if((o=Lr(s))>0){for(r=o,a=0;r>0;r--)s=e.input.charCodeAt(++e.position),(o=jr(s))>=0?a=(a<<4)+o:y(e,"expected hexadecimal character");e.result+=Br(a),e.position++}else y(e,"unknown escape sequence");n=i=e.position}else _(s)?(W(e,n,i,!0),rt(e,S(e,!1,t)),n=i=e.position):e.position===e.lineStart&&we(e)?y(e,"unexpected end of the document within a double quoted scalar"):(e.position++,i=e.position)}y(e,"unexpected end of the stream within a double quoted scalar")}function Yr(e,t){var n=!0,i,r,a,o=e.tag,s,l=e.anchor,c,p,f,u,d,g=Object.create(null),h,x,w,b;if(b=e.input.charCodeAt(e.position),b===91)p=93,d=!1,s=[];else if(b===123)p=125,d=!0,s={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=s),b=e.input.charCodeAt(++e.position);b!==0;){if(S(e,!0,t),b=e.input.charCodeAt(e.position),b===p)return e.position++,e.tag=o,e.anchor=l,e.kind=d?"mapping":"sequence",e.result=s,!0;n?b===44&&y(e,"expected the node content, but found ','"):y(e,"missed comma between flow collection entries"),x=h=w=null,f=u=!1,b===63&&(c=e.input.charCodeAt(e.position+1),L(c)&&(f=u=!0,e.position++,S(e,!0,t))),i=e.line,r=e.lineStart,a=e.position,te(e,t,Ce,!1,!0),x=e.tag,h=e.result,S(e,!0,t),b=e.input.charCodeAt(e.position),(u||e.line===i)&&b===58&&(f=!0,b=e.input.charCodeAt(++e.position),S(e,!0,t),te(e,t,Ce,!1,!0),w=e.result),d?ee(e,s,g,x,h,w,i,r,a):f?s.push(ee(e,null,g,x,h,w,i,r,a)):s.push(h),S(e,!0,t),b=e.input.charCodeAt(e.position),b===44?(n=!0,b=e.input.charCodeAt(++e.position)):n=!1}y(e,"unexpected end of the stream within a flow collection")}function Hr(e,t){var n,i,r=Ke,a=!1,o=!1,s=t,l=0,c=!1,p,f;if(f=e.input.charCodeAt(e.position),f===124)i=!1;else if(f===62)i=!0;else return!1;for(e.kind="scalar",e.result="";f!==0;)if(f=e.input.charCodeAt(++e.position),f===43||f===45)Ke===r?r=f===43?ut:Or:y(e,"repeat of a chomping mode identifier");else if((p=_r(f))>=0)p===0?y(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):o?y(e,"repeat of an indentation width identifier"):(s=t+p-1,o=!0);else break;if(G(f)){do f=e.input.charCodeAt(++e.position);while(G(f));if(f===35)do f=e.input.charCodeAt(++e.position);while(!_(f)&&f!==0)}for(;f!==0;){for(nt(e),e.lineIndent=0,f=e.input.charCodeAt(e.position);(!o||e.lineIndent<s)&&f===32;)e.lineIndent++,f=e.input.charCodeAt(++e.position);if(!o&&e.lineIndent>s&&(s=e.lineIndent),_(f)){l++;continue}if(e.lineIndent<s){r===ut?e.result+=D.repeat(`
`,a?1+l:l):r===Ke&&a&&(e.result+=`
`);break}for(i?G(f)?(c=!0,e.result+=D.repeat(`
`,a?1+l:l)):c?(c=!1,e.result+=D.repeat(`
`,l+1)):l===0?a&&(e.result+=" "):e.result+=D.repeat(`
`,l):e.result+=D.repeat(`
`,a?1+l:l),a=!0,o=!0,l=0,n=e.position;!_(f)&&f!==0;)f=e.input.charCodeAt(++e.position);W(e,n,e.position,!1)}return!0}function Ct(e,t){var n,i=e.tag,r=e.anchor,a=[],o,s=!1,l;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=a),l=e.input.charCodeAt(e.position);l!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,y(e,"tab characters must not be used in indentation")),!(l!==45||(o=e.input.charCodeAt(e.position+1),!L(o))));){if(s=!0,e.position++,S(e,!0,-1)&&e.lineIndent<=t){a.push(null),l=e.input.charCodeAt(e.position);continue}if(n=e.line,te(e,t,kt,!1,!0),a.push(e.result),S(e,!0,-1),l=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&l!==0)y(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break}return s?(e.tag=i,e.anchor=r,e.kind="sequence",e.result=a,!0):!1}function Vr(e,t,n){var i,r,a,o,s,l,c=e.tag,p=e.anchor,f={},u=Object.create(null),d=null,g=null,h=null,x=!1,w=!1,b;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=f),b=e.input.charCodeAt(e.position);b!==0;){if(!x&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,y(e,"tab characters must not be used in indentation")),i=e.input.charCodeAt(e.position+1),a=e.line,(b===63||b===58)&&L(i))b===63?(x&&(ee(e,f,u,d,g,null,o,s,l),d=g=h=null),w=!0,x=!0,r=!0):x?(x=!1,r=!0):y(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,b=i;else{if(o=e.line,s=e.lineStart,l=e.position,!te(e,n,It,!1,!0))break;if(e.line===a){for(b=e.input.charCodeAt(e.position);G(b);)b=e.input.charCodeAt(++e.position);if(b===58)b=e.input.charCodeAt(++e.position),L(b)||y(e,"a whitespace character is expected after the key-value separator within a block mapping"),x&&(ee(e,f,u,d,g,null,o,s,l),d=g=h=null),w=!0,x=!1,r=!1,d=e.tag,g=e.result;else if(w)y(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=c,e.anchor=p,!0}else if(w)y(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=c,e.anchor=p,!0}if((e.line===a||e.lineIndent>t)&&(x&&(o=e.line,s=e.lineStart,l=e.position),te(e,t,ve,!0,r)&&(x?g=e.result:h=e.result),x||(ee(e,f,u,d,g,h,o,s,l),d=g=h=null),S(e,!0,-1),b=e.input.charCodeAt(e.position)),(e.line===a||e.lineIndent>t)&&b!==0)y(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return x&&ee(e,f,u,d,g,null,o,s,l),w&&(e.tag=c,e.anchor=p,e.kind="mapping",e.result=f),w}function Ur(e){var t,n=!1,i=!1,r,a,o;if(o=e.input.charCodeAt(e.position),o!==33)return!1;if(e.tag!==null&&y(e,"duplication of a tag property"),o=e.input.charCodeAt(++e.position),o===60?(n=!0,o=e.input.charCodeAt(++e.position)):o===33?(i=!0,r="!!",o=e.input.charCodeAt(++e.position)):r="!",t=e.position,n){do o=e.input.charCodeAt(++e.position);while(o!==0&&o!==62);e.position<e.length?(a=e.input.slice(t,e.position),o=e.input.charCodeAt(++e.position)):y(e,"unexpected end of the stream within a verbatim tag")}else{for(;o!==0&&!L(o);)o===33&&(i?y(e,"tag suffix cannot contain exclamation marks"):(r=e.input.slice(t-1,e.position+1),Mt.test(r)||y(e,"named tag handle cannot contain such characters"),i=!0,t=e.position+1)),o=e.input.charCodeAt(++e.position);a=e.input.slice(t,e.position),Mr.test(a)&&y(e,"tag suffix cannot contain flow indicator characters")}a&&!jt.test(a)&&y(e,"tag name cannot contain such characters: "+a);try{a=decodeURIComponent(a)}catch(s){y(e,"tag name is malformed: "+a)}return n?e.tag=a:Y.call(e.tagMap,r)?e.tag=e.tagMap[r]+a:r==="!"?e.tag="!"+a:r==="!!"?e.tag="tag:yaml.org,2002:"+a:y(e,'undeclared tag handle "'+r+'"'),!0}function Gr(e){var t,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&y(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;n!==0&&!L(n)&&!Z(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&y(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function qr(e){var t,n,i;if(i=e.input.charCodeAt(e.position),i!==42)return!1;for(i=e.input.charCodeAt(++e.position),t=e.position;i!==0&&!L(i)&&!Z(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&y(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),Y.call(e.anchorMap,n)||y(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],S(e,!0,-1),!0}function te(e,t,n,i,r){var a,o,s,l=1,c=!1,p=!1,f,u,d,g,h,x;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,a=o=s=ve===n||kt===n,i&&S(e,!0,-1)&&(c=!0,e.lineIndent>t?l=1:e.lineIndent===t?l=0:e.lineIndent<t&&(l=-1)),l===1)for(;Ur(e)||Gr(e);)S(e,!0,-1)?(c=!0,s=a,e.lineIndent>t?l=1:e.lineIndent===t?l=0:e.lineIndent<t&&(l=-1)):s=!1;if(s&&(s=c||r),(l===1||ve===n)&&(Ce===n||It===n?h=t:h=t+1,x=e.position-e.lineStart,l===1?s&&(Ct(e,x)||Vr(e,x,h))||Yr(e,h)?p=!0:(o&&Hr(e,h)||zr(e,h)||Wr(e,h)?p=!0:qr(e)?(p=!0,(e.tag!==null||e.anchor!==null)&&y(e,"alias node should not have any properties")):Rr(e,h,Ce===n)&&(p=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):l===0&&(p=s&&Ct(e,x))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&y(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),f=0,u=e.implicitTypes.length;f<u;f+=1)if(g=e.implicitTypes[f],g.resolve(e.result)){e.result=g.construct(e.result),e.tag=g.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(Y.call(e.typeMap[e.kind||"fallback"],e.tag))g=e.typeMap[e.kind||"fallback"][e.tag];else for(g=null,d=e.typeMap.multi[e.kind||"fallback"],f=0,u=d.length;f<u;f+=1)if(e.tag.slice(0,d[f].tag.length)===d[f].tag){g=d[f];break}g||y(e,"unknown tag !<"+e.tag+">"),e.result!==null&&g.kind!==e.kind&&y(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+g.kind+'", not "'+e.kind+'"'),g.resolve(e.result,e.tag)?(e.result=g.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):y(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||p}function Kr(e){var t=e.position,n,i,r,a=!1,o;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(o=e.input.charCodeAt(e.position))!==0&&(S(e,!0,-1),o=e.input.charCodeAt(e.position),!(e.lineIndent>0||o!==37));){for(a=!0,o=e.input.charCodeAt(++e.position),n=e.position;o!==0&&!L(o);)o=e.input.charCodeAt(++e.position);for(i=e.input.slice(n,e.position),r=[],i.length<1&&y(e,"directive name must not be less than one character in length");o!==0;){for(;G(o);)o=e.input.charCodeAt(++e.position);if(o===35){do o=e.input.charCodeAt(++e.position);while(o!==0&&!_(o));break}if(_(o))break;for(n=e.position;o!==0&&!L(o);)o=e.input.charCodeAt(++e.position);r.push(e.input.slice(n,e.position))}o!==0&&nt(e),Y.call(ht,i)?ht[i](e,i,r):be(e,'unknown document directive "'+i+'"')}if(S(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,S(e,!0,-1)):a&&y(e,"directives end mark is expected"),te(e,e.lineIndent-1,ve,!1,!0),S(e,!0,-1),e.checkLineBreaks&&kr.test(e.input.slice(t,e.position))&&be(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&we(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,S(e,!0,-1));return}if(e.position<e.length-1)y(e,"end of the stream or a document separator is expected");else return}function Rt(e,t){e=String(e),t=t||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new $r(e,t),i=e.indexOf("\0");for(i!==-1&&(n.position=i,y(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)Kr(n);return n.documents}function Jr(e,t,n){t!==null&&typeof t=="object"&&typeof n=="undefined"&&(n=t,t=null);var i=Rt(e,n);if(typeof t!="function")return i;for(var r=0,a=i.length;r<a;r+=1)t(i[r])}function Qr(e,t){var n=Rt(e,t);if(n.length!==0){if(n.length===1)return n[0];throw new j("expected a single document in the stream, but found more")}}var Xr=Jr,Zr=Qr,zt={loadAll:Xr,load:Zr},Wt=Object.prototype.toString,Yt=Object.prototype.hasOwnProperty,it=65279,ei=9,oe=10,ti=13,ni=32,ri=33,ii=34,Qe=35,oi=37,ai=38,si=39,li=42,Ht=44,ci=45,xe=58,pi=61,fi=62,di=63,ui=64,Vt=91,Ut=93,gi=96,Gt=123,mi=124,qt=125,M={};M[0]="\\0";M[7]="\\a";M[8]="\\b";M[9]="\\t";M[10]="\\n";M[11]="\\v";M[12]="\\f";M[13]="\\r";M[27]="\\e";M[34]='\\"';M[92]="\\\\";M[133]="\\N";M[160]="\\_";M[8232]="\\L";M[8233]="\\P";var hi=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],yi=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Ci(e,t){var n,i,r,a,o,s,l;if(t===null)return{};for(n={},i=Object.keys(t),r=0,a=i.length;r<a;r+=1)o=i[r],s=String(t[o]),o.slice(0,2)==="!!"&&(o="tag:yaml.org,2002:"+o.slice(2)),l=e.compiledTypeMap.fallback[o],l&&Yt.call(l.styleAliases,s)&&(s=l.styleAliases[s]),n[o]=s;return n}function vi(e){var t,n,i;if(t=e.toString(16).toUpperCase(),e<=255)n="x",i=2;else if(e<=65535)n="u",i=4;else if(e<=4294967295)n="U",i=8;else throw new j("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+n+D.repeat("0",i-t.length)+t}var bi=1,ae=2;function xi(e){this.schema=e.schema||Ot,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=D.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Ci(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?ae:bi,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function vt(e,t){for(var n=D.repeat(" ",t),i=0,r=-1,a="",o,s=e.length;i<s;)r=e.indexOf(`
`,i),r===-1?(o=e.slice(i),i=s):(o=e.slice(i,r+1),i=r+1),o.length&&o!==`
`&&(a+=n),a+=o;return a}function Xe(e,t){return`
`+D.repeat(" ",e.indent*t)}function Pi(e,t){var n,i,r;for(n=0,i=e.implicitTypes.length;n<i;n+=1)if(r=e.implicitTypes[n],r.resolve(t))return!0;return!1}function Pe(e){return e===ni||e===ei}function se(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==it||65536<=e&&e<=1114111}function bt(e){return se(e)&&e!==it&&e!==ti&&e!==oe}function xt(e,t,n){var i=bt(e),r=i&&!Pe(e);return(n?i:i&&e!==Ht&&e!==Vt&&e!==Ut&&e!==Gt&&e!==qt)&&e!==Qe&&!(t===xe&&!r)||bt(t)&&!Pe(t)&&e===Qe||t===xe&&r}function wi(e){return se(e)&&e!==it&&!Pe(e)&&e!==ci&&e!==di&&e!==xe&&e!==Ht&&e!==Vt&&e!==Ut&&e!==Gt&&e!==qt&&e!==Qe&&e!==ai&&e!==li&&e!==ri&&e!==mi&&e!==pi&&e!==fi&&e!==si&&e!==ii&&e!==oi&&e!==ui&&e!==gi}function Fi(e){return!Pe(e)&&e!==xe}function re(e,t){var n=e.charCodeAt(t),i;return n>=55296&&n<=56319&&t+1<e.length&&(i=e.charCodeAt(t+1),i>=56320&&i<=57343)?(n-55296)*1024+i-56320+65536:n}function Kt(e){var t=/^\n* /;return t.test(e)}var Jt=1,Ze=2,Qt=3,Xt=4,X=5;function Ai(e,t,n,i,r,a,o,s){var l,c=0,p=null,f=!1,u=!1,d=i!==-1,g=-1,h=wi(re(e,0))&&Fi(re(e,e.length-1));if(t||o)for(l=0;l<e.length;c>=65536?l+=2:l++){if(c=re(e,l),!se(c))return X;h=h&&xt(c,p,s),p=c}else{for(l=0;l<e.length;c>=65536?l+=2:l++){if(c=re(e,l),c===oe)f=!0,d&&(u=u||l-g-1>i&&e[g+1]!==" ",g=l);else if(!se(c))return X;h=h&&xt(c,p,s),p=c}u=u||d&&l-g-1>i&&e[g+1]!==" "}return!f&&!u?h&&!o&&!r(e)?Jt:a===ae?X:Ze:n>9&&Kt(e)?X:o?a===ae?X:Ze:u?Xt:Qt}function Ti(e,t,n,i,r){e.dump=function(){if(t.length===0)return e.quotingType===ae?'""':"''";if(!e.noCompatMode&&(hi.indexOf(t)!==-1||yi.test(t)))return e.quotingType===ae?'"'+t+'"':"'"+t+"'";var a=e.indent*Math.max(1,n),o=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-a),s=i||e.flowLevel>-1&&n>=e.flowLevel;function l(c){return Pi(e,c)}switch(Ai(t,s,e.indent,o,l,e.quotingType,e.forceQuotes&&!i,r)){case Jt:return t;case Ze:return"'"+t.replace(/'/g,"''")+"'";case Qt:return"|"+Pt(t,e.indent)+wt(vt(t,a));case Xt:return">"+Pt(t,e.indent)+wt(vt(Si(t,o),a));case X:return'"'+Ei(t)+'"';default:throw new j("impossible error: invalid scalar style")}}()}function Pt(e,t){var n=Kt(e)?String(t):"",i=e[e.length-1]===`
`,r=i&&(e[e.length-2]===`
`||e===`
`),a=r?"+":i?"":"-";return n+a+`
`}function wt(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Si(e,t){for(var n=/(\n+)([^\n]*)/g,i=function(){var c=e.indexOf(`
`);return c=c!==-1?c:e.length,n.lastIndex=c,Ft(e.slice(0,c),t)}(),r=e[0]===`
`||e[0]===" ",a,o;o=n.exec(e);){var s=o[1],l=o[2];a=l[0]===" ",i+=s+(!r&&!a&&l!==""?`
`:"")+Ft(l,t),r=a}return i}function Ft(e,t){if(e===""||e[0]===" ")return e;for(var n=/ [^ ]/g,i,r=0,a,o=0,s=0,l="";i=n.exec(e);)s=i.index,s-r>t&&(a=o>r?o:s,l+=`
`+e.slice(r,a),r=a+1),o=s;return l+=`
`,e.length-r>t&&o>r?l+=e.slice(r,o)+`
`+e.slice(o+1):l+=e.slice(r),l.slice(1)}function Ei(e){for(var t="",n=0,i,r=0;r<e.length;n>=65536?r+=2:r++)n=re(e,r),i=M[n],!i&&se(n)?(t+=e[r],n>=65536&&(t+=e[r+1])):t+=i||vi(n);return t}function Di(e,t,n){var i="",r=e.tag,a,o,s;for(a=0,o=n.length;a<o;a+=1)s=n[a],e.replacer&&(s=e.replacer.call(n,String(a),s)),($(e,t,s,!1,!1)||typeof s=="undefined"&&$(e,t,null,!1,!1))&&(i!==""&&(i+=","+(e.condenseFlow?"":" ")),i+=e.dump);e.tag=r,e.dump="["+i+"]"}function At(e,t,n,i){var r="",a=e.tag,o,s,l;for(o=0,s=n.length;o<s;o+=1)l=n[o],e.replacer&&(l=e.replacer.call(n,String(o),l)),($(e,t+1,l,!0,!0,!1,!0)||typeof l=="undefined"&&$(e,t+1,null,!0,!0,!1,!0))&&((!i||r!=="")&&(r+=Xe(e,t)),e.dump&&oe===e.dump.charCodeAt(0)?r+="-":r+="- ",r+=e.dump);e.tag=a,e.dump=r||"[]"}function Ni(e,t,n){var i="",r=e.tag,a=Object.keys(n),o,s,l,c,p;for(o=0,s=a.length;o<s;o+=1)p="",i!==""&&(p+=", "),e.condenseFlow&&(p+='"'),l=a[o],c=n[l],e.replacer&&(c=e.replacer.call(n,l,c)),$(e,t,l,!1,!1)&&(e.dump.length>1024&&(p+="? "),p+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),$(e,t,c,!1,!1)&&(p+=e.dump,i+=p));e.tag=r,e.dump="{"+i+"}"}function Oi(e,t,n,i){var r="",a=e.tag,o=Object.keys(n),s,l,c,p,f,u;if(e.sortKeys===!0)o.sort();else if(typeof e.sortKeys=="function")o.sort(e.sortKeys);else if(e.sortKeys)throw new j("sortKeys must be a boolean or a function");for(s=0,l=o.length;s<l;s+=1)u="",(!i||r!=="")&&(u+=Xe(e,t)),c=o[s],p=n[c],e.replacer&&(p=e.replacer.call(n,c,p)),$(e,t+1,c,!0,!0,!0)&&(f=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,f&&(e.dump&&oe===e.dump.charCodeAt(0)?u+="?":u+="? "),u+=e.dump,f&&(u+=Xe(e,t)),$(e,t+1,p,!0,f)&&(e.dump&&oe===e.dump.charCodeAt(0)?u+=":":u+=": ",u+=e.dump,r+=u));e.tag=a,e.dump=r||"{}"}function Tt(e,t,n){var i,r,a,o,s,l;for(r=n?e.explicitTypes:e.implicitTypes,a=0,o=r.length;a<o;a+=1)if(s=r[a],(s.instanceOf||s.predicate)&&(!s.instanceOf||typeof t=="object"&&t instanceof s.instanceOf)&&(!s.predicate||s.predicate(t))){if(n?s.multi&&s.representName?e.tag=s.representName(t):e.tag=s.tag:e.tag="?",s.represent){if(l=e.styleMap[s.tag]||s.defaultStyle,Wt.call(s.represent)==="[object Function]")i=s.represent(t,l);else if(Yt.call(s.represent,l))i=s.represent[l](t,l);else throw new j("!<"+s.tag+'> tag resolver accepts not "'+l+'" style');e.dump=i}return!0}return!1}function $(e,t,n,i,r,a,o){e.tag=null,e.dump=n,Tt(e,n,!1)||Tt(e,n,!0);var s=Wt.call(e.dump),l=i,c;i&&(i=e.flowLevel<0||e.flowLevel>t);var p=s==="[object Object]"||s==="[object Array]",f,u;if(p&&(f=e.duplicates.indexOf(n),u=f!==-1),(e.tag!==null&&e.tag!=="?"||u||e.indent!==2&&t>0)&&(r=!1),u&&e.usedDuplicates[f])e.dump="*ref_"+f;else{if(p&&u&&!e.usedDuplicates[f]&&(e.usedDuplicates[f]=!0),s==="[object Object]")i&&Object.keys(e.dump).length!==0?(Oi(e,t,e.dump,r),u&&(e.dump="&ref_"+f+e.dump)):(Ni(e,t,e.dump),u&&(e.dump="&ref_"+f+" "+e.dump));else if(s==="[object Array]")i&&e.dump.length!==0?(e.noArrayIndent&&!o&&t>0?At(e,t-1,e.dump,r):At(e,t,e.dump,r),u&&(e.dump="&ref_"+f+e.dump)):(Di(e,t,e.dump),u&&(e.dump="&ref_"+f+" "+e.dump));else if(s==="[object String]")e.tag!=="?"&&Ti(e,e.dump,t,a,l);else{if(s==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new j("unacceptable kind of an object to dump "+s)}e.tag!==null&&e.tag!=="?"&&(c=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?c="!"+c:c.slice(0,18)==="tag:yaml.org,2002:"?c="!!"+c.slice(18):c="!<"+c+">",e.dump=c+" "+e.dump)}return!0}function Ii(e,t){var n=[],i=[],r,a;for(et(e,n,i),r=0,a=i.length;r<a;r+=1)t.duplicates.push(n[i[r]]);t.usedDuplicates=new Array(a)}function et(e,t,n){var i,r,a;if(e!==null&&typeof e=="object")if(r=t.indexOf(e),r!==-1)n.indexOf(r)===-1&&n.push(r);else if(t.push(e),Array.isArray(e))for(r=0,a=e.length;r<a;r+=1)et(e[r],t,n);else for(i=Object.keys(e),r=0,a=i.length;r<a;r+=1)et(e[i[r]],t,n)}function ki(e,t){t=t||{};var n=new xi(t);n.noRefs||Ii(e,n);var i=e;return n.replacer&&(i=n.replacer.call({"":i},"",i)),$(n,0,i,!0,!0)?n.dump+`
`:""}var Mi=ki,ji={dump:Mi};function ot(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}var Fe=zt.load,oo=zt.loadAll,ao=ji.dump;var so=ot("safeLoad","load"),lo=ot("safeLoadAll","loadAll"),co=ot("safeDump","dump");var Ae=class{constructor(t){this.app=t}async findExampleFile(t){let n=this.app.vault.getAbstractFileByPath(t);if(!n)return null;if(n instanceof at.TFile&&n.extension==="md")return await this.parseFrontmatter(n);let i=this.getMarkdownFiles(n);for(let r of i){let a=await this.parseFrontmatter(r);if(a)return a}return null}getMarkdownFiles(t){let n=[];if(t.children)for(let i of t.children)i instanceof at.TFile&&i.extension==="md"?n.push(i):i.children&&n.push(...this.getMarkdownFiles(i));return n}async parseFrontmatter(t){try{let n=await this.app.vault.read(t),i=/^---\s*\n([\s\S]*?)\n---\s*\n/,r=n.match(i);if(!r)return null;let a=r[1],o=Fe(a);return!o||typeof o!="object"?null:{file:t.path,frontmatter:o,rawYaml:a}}catch(n){return null}}autoDetectDateProperty(t){let n=["date","pubDate","publishedDate","publishDate"];for(let i of n)if(t.hasOwnProperty(i))return i;return null}autoDetectDescriptionProperty(t){let n=["description","summary","excerpt","intro","snippet","blurb"];for(let i of n)if(t.hasOwnProperty(i))return i;return null}autoDetectTagsProperty(t){return t.hasOwnProperty("tags")?"tags":null}autoDetectDraftProperty(t){return t.hasOwnProperty("draft")?{property:"draft",logic:"true-draft"}:t.hasOwnProperty("published")?{property:"published",logic:"false-draft"}:null}autoDetectImageProperty(t){let n=["image","cover","coverImage","thumbnail","featuredImage"];for(let i of n)if(t.hasOwnProperty(i))return i;return null}};var Te=class extends A{constructor(n,i,r,a,o,s){super(n,i,r,a,o,s);this.examples={};this.frontmatterAnalyzer=new Ae(n)}async display(){let{containerEl:n}=this,i=n.querySelector(".frontmatter-step-content");i&&i.remove();let r=n.createDiv({cls:"frontmatter-step-content"});r.createEl("h2",{text:"Frontmatter Properties"}),r.createEl("p",{text:"Map frontmatter properties for each content type. We'll find example files to help you."});for(let a of this.state.contentTypes){if(!a.enabled)continue;let o=r.createDiv({cls:"content-type-settings"});if(!this.examples[a.id]){let m=await this.frontmatterAnalyzer.findExampleFile(a.folder);m&&(this.examples[a.id]=m)}let s=this.examples[a.id];if(o.createEl("h3",{text:a.name}),s){o.createEl("p",{text:`Example file: ${s.file}`});let m=o.createEl("pre",{text:s.rawYaml,cls:"frontmatter-example"});m.style.fontFamily="var(--font-monospace)",m.style.fontSize="0.85em",m.style.whiteSpace="pre-wrap",m.style.wordWrap="break-word",m.style.overflowWrap="break-word",m.style.maxWidth="100%",m.style.padding="10px",m.style.backgroundColor="var(--background-secondary)",m.style.borderRadius="4px",m.style.border="1px solid var(--background-modifier-border)";let C=this.frontmatterAnalyzer.autoDetectDateProperty(s.frontmatter),v=this.frontmatterAnalyzer.autoDetectDescriptionProperty(s.frontmatter)}if(!this.state.frontmatterProperties[a.id]){let m=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null,C=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null,v=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null,F=s?this.frontmatterAnalyzer.autoDetectDescriptionProperty(s.frontmatter):null,O=s&&s.frontmatter.hasOwnProperty("title")?"title":null,T=s?this.frontmatterAnalyzer.autoDetectDateProperty(s.frontmatter):null;this.state.frontmatterProperties[a.id]={titleProperty:O||void 0,dateProperty:T||void 0,descriptionProperty:F||void 0,tagsProperty:C||void 0,draftProperty:m==null?void 0:m.property,draftLogic:(m==null?void 0:m.property)==="published"?"false-draft":m?"true-draft":void 0,imageProperty:v||void 0}}let l=this.state.frontmatterProperties[a.id];new N.Setting(o).setName("Title Property").setDesc("The frontmatter property that contains the title (e.g., title, name, heading). Leave blank to use file name instead.").addText(m=>{let C="title";m.setPlaceholder(C).setValue(l.titleProperty||"").onChange(v=>{l.titleProperty=v.trim()||void 0})}),new N.Setting(o).setName("Date Property").setDesc("The frontmatter property that contains the date (e.g., date, pubDate, publishedDate, publishDate). Leave blank to use file created date instead.").addText(m=>{let C=s?this.frontmatterAnalyzer.autoDetectDateProperty(s.frontmatter):null;m.setPlaceholder(C||"date").setValue(l.dateProperty||"").onChange(v=>{l.dateProperty=v.trim()||void 0})});let c=new N.Setting(o).setName("Has Description/Summary?").setDesc("Does this content type have a description or summary field?"),p=null;c.addToggle(m=>m.setValue(!!l.descriptionProperty).onChange(C=>{C&&!l.descriptionProperty?(l.descriptionProperty=s&&this.frontmatterAnalyzer.autoDetectDescriptionProperty(s.frontmatter)||"description",p||(p=new N.Setting(o).setName("Description Property").setDesc("The frontmatter property that contains the description (e.g., description, summary, excerpt, intro, snippet, blurb)").addText(v=>v.setValue(l.descriptionProperty||"").onChange(F=>{l.descriptionProperty=F.trim()||void 0})),p.settingEl.remove(),c.settingEl.insertAdjacentElement("afterend",p.settingEl))):C||(l.descriptionProperty=void 0,p&&(p.settingEl.remove(),p=null))})),l.descriptionProperty&&(p=new N.Setting(o).setName("Description Property").setDesc("The frontmatter property that contains the description (e.g., description, summary, excerpt, intro, snippet, blurb)").addText(m=>m.setValue(l.descriptionProperty||"").onChange(C=>{l.descriptionProperty=C.trim()||void 0})),p.settingEl.remove(),c.settingEl.insertAdjacentElement("afterend",p.settingEl));let f=new N.Setting(o).setName("Has Tags?").setDesc("Does this content type have tags?"),u=null;f.addToggle(m=>m.setValue(!!l.tagsProperty).onChange(C=>{if(C&&!l.tagsProperty){let v=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null;l.tagsProperty=v||"tags",u||(u=new N.Setting(o).setName("Tags Property").setDesc("The frontmatter property that contains tags (e.g., tags, tag, categories, category). Leave blank if not applicable.").addText(F=>{let O=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null;F.setPlaceholder(O||"tags").setValue(l.tagsProperty||"").onChange(T=>{l.tagsProperty=T.trim()||void 0})}),u.settingEl.remove(),f.settingEl.insertAdjacentElement("afterend",u.settingEl))}else C||(l.tagsProperty=void 0,u&&(u.settingEl.remove(),u=null))})),l.tagsProperty&&(u=new N.Setting(o).setName("Tags Property").setDesc("The frontmatter property that contains tags (e.g., tags, tag, categories, category). Leave blank if not applicable.").addText(m=>{let C=s?this.frontmatterAnalyzer.autoDetectTagsProperty(s.frontmatter):null;m.setPlaceholder(C||"tags").setValue(l.tagsProperty||"").onChange(v=>{l.tagsProperty=v.trim()||void 0})}),u.settingEl.remove(),f.settingEl.insertAdjacentElement("afterend",u.settingEl));let d=new N.Setting(o).setName("Has Draft Status?").setDesc("Does this content type have draft status?"),g=null,h=null;d.addToggle(m=>m.setValue(!!l.draftProperty).onChange(C=>{if(C&&!l.draftProperty){let v=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null;l.draftProperty=(v==null?void 0:v.property)||"draft",(v==null?void 0:v.property)==="published"?l.draftLogic="false-draft":l.draftLogic="true-draft",g||(g=new N.Setting(o).setName("Draft Property").setDesc("The frontmatter property that contains draft status. Leave blank to use an underscore prefix instead.").addText(F=>{let O=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null;F.setPlaceholder((O==null?void 0:O.property)||"draft").setValue(l.draftProperty||"").onChange(T=>{l.draftProperty=T.trim()||void 0,T==="published"?l.draftLogic="false-draft":T&&(l.draftLogic="true-draft"),T&&!h?(h=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(B=>B.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(an=>{l.draftLogic=an})),h.settingEl.remove(),g&&g.settingEl.insertAdjacentElement("afterend",h.settingEl)):!T&&h&&(h.settingEl.remove(),h=null)})}),g.settingEl.remove(),d.settingEl.insertAdjacentElement("afterend",g.settingEl)),l.draftProperty&&!h&&(h=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(F=>F.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(O=>{l.draftLogic=O})),h.settingEl.remove(),g&&g.settingEl.insertAdjacentElement("afterend",h.settingEl))}else C||(l.draftProperty=void 0,l.draftLogic=void 0,g&&(g.settingEl.remove(),g=null),h&&(h.settingEl.remove(),h=null))})),l.draftProperty&&(g=new N.Setting(o).setName("Draft Property").setDesc("The frontmatter property that contains draft status. Leave blank to use an underscore prefix instead.").addText(m=>{let C=s?this.frontmatterAnalyzer.autoDetectDraftProperty(s.frontmatter):null;m.setPlaceholder((C==null?void 0:C.property)||"draft").setValue(l.draftProperty||"").onChange(v=>{l.draftProperty=v.trim()||void 0,v==="published"?l.draftLogic="false-draft":v&&(l.draftLogic="true-draft"),v&&!h?(h=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(F=>F.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(O=>{l.draftLogic=O})),h.settingEl.remove(),g&&g.settingEl.insertAdjacentElement("afterend",h.settingEl)):!v&&h&&(h.settingEl.remove(),h=null)})}),g.settingEl.remove(),d.settingEl.insertAdjacentElement("afterend",g.settingEl),l.draftProperty&&(h=new N.Setting(o).setName("Draft Logic").setDesc("How draft status is represented").addDropdown(m=>m.addOption("true-draft","true = draft").addOption("false-draft","false = draft").setValue(l.draftLogic||"true-draft").onChange(C=>{l.draftLogic=C})),h.settingEl.remove(),g&&g.settingEl.insertAdjacentElement("afterend",h.settingEl)));let x=new N.Setting(o).setName("Has Image/Cover Property?").setDesc("Does this content type have an image or cover property? Used for Bases CMS cover images, Simple Banner, and Image Inserter."),w=null;if(x.addToggle(m=>m.setValue(!!l.imageProperty).onChange(C=>{if(C&&!l.imageProperty){let v=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null;l.imageProperty=v||"image",w||(w=new N.Setting(o).setName("Image Property").setDesc("The frontmatter property that contains the image/cover (e.g., image, cover, coverImage, thumbnail, featuredImage). Leave blank if not applicable.").addText(F=>{let O=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null;F.setPlaceholder(O||"image").setValue(l.imageProperty||"").onChange(T=>{l.imageProperty=T.trim()||void 0})}),w.settingEl.remove(),x.settingEl.insertAdjacentElement("afterend",w.settingEl))}else C||(l.imageProperty=void 0,w&&(w.settingEl.remove(),w=null))})),l.imageProperty&&(w=new N.Setting(o).setName("Image Property").setDesc("The frontmatter property that contains the image/cover (e.g., image, cover, coverImage, thumbnail, featuredImage). Leave blank if not applicable.").addText(m=>{let C=s?this.frontmatterAnalyzer.autoDetectImageProperty(s.frontmatter):null;m.setPlaceholder(C||"image").setValue(l.imageProperty||"").onChange(v=>{l.imageProperty=v.trim()||void 0})}),w.settingEl.remove(),x.settingEl.insertAdjacentElement("afterend",w.settingEl)),o.createEl("h4",{text:"Template"}),o.createEl("p",{text:'Edit the template that will be used when creating new files of this content type. Use {{title}} and {{date}} as variables. Note: {{title}} should be in quotes (e.g., title: "{{title}}"), while {{date}} should not be in quotes (e.g., date: {{date}}).'}),!l.template){let m=a.name==="Posts";l.template=this.generateDefaultTemplate(l,m,s)}let b=o.createEl("textarea",{cls:"template-editor",attr:{rows:"10",style:"width: 100%; font-family: monospace;",spellcheck:"false"}});b.value=l.template||"",b.addEventListener("input",m=>{let C=m.target;l.template=C.value})}}generateDefaultTemplate(n,i,r){let a=`---
`;if(r&&r.rawYaml){let o=r.rawYaml.split(`
`),s=new Set,l=!1;if(n.titleProperty){for(let c of o){let p=c.trim();if(!p||p.startsWith("#"))continue;let f=p.indexOf(":");if(f>0){let u=p.substring(0,f).trim();if(u===n.titleProperty){a+=`${n.titleProperty}: "{{title}}"
`,l=!0,s.add(u);continue}}}l||(a+=`${n.titleProperty}: "{{title}}"
`)}for(let c of o){let p=c.trim();if(!p||p.startsWith("#"))continue;let f=p.indexOf(":");if(f>0){let u=p.substring(0,f).trim();if(s.has(u)||u===n.titleProperty)continue;if(u===n.dateProperty&&n.dateProperty){a+=`${n.dateProperty}: {{date}}
`,s.add(u);continue}if(u===n.descriptionProperty){a+=`${n.descriptionProperty}: ""
`,s.add(u);continue}let d=r.frontmatter[u];d==null?a+=`${u}:
`:Array.isArray(d)?a+=`${u}: []
`:typeof d=="boolean"?a+=`${u}: ${d}
`:typeof d=="number"?a+=`${u}: ${d}
`:typeof d=="string"?/^\d{4}-\d{2}-\d{2}/.test(d)&&u.toLowerCase().includes("date")?a+=`${u}: {{date}}
`:a+=`${u}: ""
`:typeof d=="object"&&(Array.isArray(d)?a+=`${u}: []
`:a+=`${u}:
`),s.add(u)}}}else if(n.titleProperty&&(a+=`${n.titleProperty}: "{{title}}"
`),n.dateProperty&&(a+=`${n.dateProperty}: {{date}}
`),n.descriptionProperty&&(a+=`${n.descriptionProperty}: ""
`),n.tagsProperty&&(a+=`${n.tagsProperty}: []
`),n.draftProperty){let o=n.draftLogic==="false-draft"?"false":"true";a+=`${n.draftProperty}: ${o}
`}return a+=`---
`,a}validate(){return!0}getTitle(){return"Frontmatter Properties"}getDescription(){return"Map frontmatter properties"}};var en=require("obsidian");var Se=class extends A{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"WYSIWYG Editing Toolbar"}),t.createEl("p",{text:"Do you want to use the WYSIWYG editing toolbar?"}),t.createEl("p",{text:"This enables a visual editing toolbar for formatting text. The toolbar can be toggled on/off via command."}),new en.Setting(t).setName("Enable WYSIWYG Toolbar").setDesc("Show the editing toolbar command in the page header").addToggle(n=>n.setValue(this.state.enableWYSIWYG).onChange(i=>{this.state.enableWYSIWYG=i}))}validate(){return!0}getTitle(){return"WYSIWYG Preference"}getDescription(){return"Configure editing toolbar preference"}};var Ee=class extends A{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Bases CMS Configuration"}),t.createEl("p",{text:"Bases CMS views will be automatically created for each enabled content type using your mapped frontmatter properties."});let n=this.state.contentTypes.filter(r=>r.enabled);if(n.length===0){t.createEl("p",{text:"No content types enabled. Please go back and enable at least one content type."});return}t.createEl("h3",{text:"Views to be created:"});let i=t.createEl("ul");for(let r of n){let a=this.state.frontmatterProperties[r.id];if(a){let o=[];a.titleProperty&&o.push(`title: ${a.titleProperty}`),a.dateProperty&&o.push(`date: ${a.dateProperty}`),a.descriptionProperty&&o.push(`description: ${a.descriptionProperty}`),a.tagsProperty&&o.push(`tags: ${a.tagsProperty}`),a.imageProperty&&o.push(`image: ${a.imageProperty}`),a.draftProperty&&o.push(`draft: ${a.draftProperty}`);let s=o.length>0?o.join(", "):"default properties";i.createEl("li",{text:`${r.name}: ${s}`})}}t.createEl("p",{text:"You can customize these views later in the Bases CMS settings."})}validate(){return this.state.contentTypes.some(t=>t.enabled)}getTitle(){return"Bases CMS Configuration"}getDescription(){return"Configure Bases CMS views"}};var De=class extends A{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Astro Composer Configuration"}),t.createEl("p",{text:"Astro Composer will be configured with your content types and frontmatter properties."});let n=this.state.contentTypes.filter(r=>r.enabled);if(n.length===0){t.createEl("p",{text:"No content types enabled."});return}t.createEl("h3",{text:"Content types to configure:"});let i=t.createEl("ul");for(let r of n)if(this.state.frontmatterProperties[r.id]){let o=r.fileOrganization==="folder"?"folder-based":"file-based";i.createEl("li",{text:`${r.name} (${r.folder}): ${o}`})}this.state.projectDetection&&(this.state.projectDetection.projectRoot&&t.createEl("p",{text:`Project root: ${this.state.projectDetection.projectRoot}`}),this.state.projectDetection.configFilePath&&t.createEl("p",{text:`Config file: ${this.state.projectDetection.configFilePath}`}))}validate(){return!0}getTitle(){return"Astro Composer Configuration"}getDescription(){return"Configure Astro Composer"}};var tn=require("obsidian");var Ne=class extends A{display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"SEO Plugin Configuration"}),t.createEl("p",{text:"SEO plugin will be configured using your mapped frontmatter properties."});let n=this.state.contentTypes.filter(s=>s.enabled),i=n[0],r=i?this.state.frontmatterProperties[i.id]:void 0,a=new Set,o=new Set;for(let s of n){let l=this.state.frontmatterProperties[s.id];l&&(l.titleProperty&&a.add(l.titleProperty),l.descriptionProperty&&o.add(l.descriptionProperty))}if(a.size>1||o.size>1){let s=t.createDiv({cls:"vault-cms-warning"});s.style.padding="10px",s.style.backgroundColor="var(--background-modifier-border)",s.style.borderLeft="3px solid var(--text-warning)",s.style.marginBottom="15px",s.createEl("p",{text:"\u26A0\uFE0F Warning: Different content types use different properties for title or description.",attr:{style:"margin: 0 0 5px 0; font-weight: bold;"}}),s.createEl("p",{text:"The SEO plugin will use the first content type's properties. You may need to manually configure SEO settings for other content types.",attr:{style:"margin: 0;"}})}if(r){t.createEl("h3",{text:"Configuration:"}),t.createEl("p",{text:`Title property: ${r.titleProperty||"(using filename)"}`}),r.descriptionProperty&&t.createEl("p",{text:`Description property: ${r.descriptionProperty}`});let s=n.map(l=>l.folder).join(", ");t.createEl("p",{text:`Scan directories: ${s}`})}new tn.Setting(t).setName("Scan Directories").setDesc("Comma-separated list of directories to scan (you can customize this)").addText(s=>s.setValue(this.state.contentTypes.filter(l=>l.enabled).map(l=>l.folder).join(",")).onChange(l=>{this.state.seoConfig&&(this.state.seoConfig.scanDirectories=l)}))}validate(){return!0}getTitle(){return"SEO Configuration"}getDescription(){return"Configure SEO plugin"}};var st=require("obsidian"),le=require("obsidian");var ne=class{constructor(t){this.app=t}async enablePlugin(t){let n=this.app.plugins;if(!n)return;let i=n.plugins[t];i&&!i.enabled&&await n.enablePlugin(t)}async disablePlugin(t){let n=this.app.plugins;if(!n)return;let i=n.plugins[t];i&&i.enabled&&await n.disablePlugin(t)}async setPluginStates(t,n){for(let i of n)await this.disablePlugin(i);for(let i of t)await this.enablePlugin(i)}getPresetPlugins(t){let n=["astro-composer","bases-cms","homepage","new-tab-default-page","seo","property-over-file-name","settings-search","statusbar-organizer","zenmode","cmdr","editing-toolbar","simple-focus","tag-wrangler"],i=["insert-unsplash-image","custom-save","title-only-tab","obsidian-paste-image-rename","obsidian42-brat","obsidian-hider","disable-tabs","obsidian-style-settings","mdx-as-md-obsidian"],r=["obsidian-oxygen","obsidian-style-settings"];return t==="vanilla"?{enabled:[...n,...i.filter(a=>!r.includes(a))],disabled:r}:t==="opinionated"?{enabled:[...n,...i],disabled:[]}:{enabled:[],disabled:[]}}};var Oe=class extends A{constructor(n,i,r,a,o,s){super(n,i,r,a,o,s);this.pluginManager=new ne(n)}display(){var c,p,f,u,d,g,h,x,w,b;let{containerEl:n}=this;n.empty(),n.createEl("h2",{text:"Plugin Configuration"}),n.createEl("p",{text:"Review and configure your installed plugins. Essential plugins are recommended for the core Vault CMS experience."});let i=[{id:"astro-composer",name:"Astro Composer",category:"essential"},{id:"bases-cms",name:"Bases CMS",category:"essential"},{id:"cmdr",name:"Commander",category:"essential"},{id:"new-tab-default-page",name:"Default New Tab Page",category:"essential"},{id:"editing-toolbar",name:"Editing Toolbar",category:"essential"},{id:"homepage",name:"Homepage",category:"essential"},{id:"obsidian-paste-image-rename",name:"Paste Image Rename",category:"essential"},{id:"property-over-file-name",name:"Property Over File Name",category:"essential"},{id:"seo",name:"SEO",category:"essential"},{id:"simple-focus",name:"Simple Focus",category:"essential"},{id:"statusbar-organizer",name:"Status Bar Organizer",category:"essential"},{id:"zenmode",name:"Zen Mode",category:"essential"},{id:"iconic",name:"Iconic",category:"nice-to-have"},{id:"settings-search",name:"Settings Search",category:"nice-to-have"},{id:"simple-banner",name:"Simple Banner",category:"nice-to-have"},{id:"tag-wrangler",name:"Tag Wrangler",category:"nice-to-have"},{id:"insert-unsplash-image",name:"Image Inserter",category:"nice-to-have"},{id:"paste-image-into-property",name:"Paste Image Into Property",category:"nice-to-have"}],r=this.app.plugins,a=r!=null&&r.plugins?Object.keys(r.plugins):[],o=["obsidian42-brat","astro-modular-settings","alias-file-name-history","folder-notes","disable-tabs","vault-cms"],s=i.filter(m=>m.category==="essential"&&a.includes(m.id)&&!o.includes(m.id)),l=i.filter(m=>m.category==="nice-to-have"&&a.includes(m.id)&&!o.includes(m.id));if(s.length>0){n.createEl("h3",{text:"Essential Plugins",cls:"vault-cms-section-header"}),n.createEl("p",{text:"These plugins are recommended for the core Vault CMS experience.",cls:"vault-cms-section-desc"});for(let m of s){let C=(c=r==null?void 0:r.plugins)==null?void 0:c[m.id],v=!!C,F=(d=(u=(f=(p=r==null?void 0:r.enabledPlugins)==null?void 0:p.has)==null?void 0:f.call(p,m.id))!=null?u:C==null?void 0:C.enabled)!=null?d:!1;console.log(`Plugin ${m.id}: installed=${v}, enabled=${F}`),v&&F?(this.state.enabledPlugins.includes(m.id)||this.state.enabledPlugins.push(m.id),this.state.disabledPlugins=this.state.disabledPlugins.filter(B=>B!==m.id)):v&&!F&&(this.state.enabledPlugins=this.state.enabledPlugins.filter(B=>B!==m.id),this.state.disabledPlugins.includes(m.id)||this.state.disabledPlugins.push(m.id));let T=new st.Setting(n).setName(m.name).setDesc(v?F?"Installed and enabled":"Installed but disabled":"Not installed").controlEl.createDiv({cls:"vault-cms-plugin-status"});v&&F?((0,le.setIcon)(T,"lucide-check-circle-2"),T.style.color="var(--text-success)"):((0,le.setIcon)(T,"lucide-x-circle"),T.style.color="var(--text-error)")}}if(l.length>0){n.createEl("h3",{text:"Nice to Have Plugins",cls:"vault-cms-section-header"}),n.createEl("p",{text:"These plugins can be helpful depending on your theme's capabilities and workflow needs.",cls:"vault-cms-section-desc"});for(let m of l){let C=(g=r==null?void 0:r.plugins)==null?void 0:g[m.id],v=!!C,F=(b=(w=(x=(h=r==null?void 0:r.enabledPlugins)==null?void 0:h.has)==null?void 0:x.call(h,m.id))!=null?w:C==null?void 0:C.enabled)!=null?b:!1;console.log(`Plugin ${m.id}: installed=${v}, enabled=${F}`),v&&F?(this.state.enabledPlugins.includes(m.id)||this.state.enabledPlugins.push(m.id),this.state.disabledPlugins=this.state.disabledPlugins.filter(B=>B!==m.id)):v&&!F&&(this.state.enabledPlugins=this.state.enabledPlugins.filter(B=>B!==m.id),this.state.disabledPlugins.includes(m.id)||this.state.disabledPlugins.push(m.id));let T=new st.Setting(n).setName(m.name).setDesc(v?F?"Installed and enabled":"Installed but disabled":"Not installed").controlEl.createDiv({cls:"vault-cms-plugin-status"});v&&F?((0,le.setIcon)(T,"lucide-check-circle-2"),T.style.color="var(--text-success)"):((0,le.setIcon)(T,"lucide-x-circle"),T.style.color="var(--text-error)")}}s.length===0&&l.length===0&&n.createEl("p",{text:"No Vault CMS plugins detected. Make sure you have installed the recommended plugins."})}validate(){return!0}getTitle(){return"Optional Plugins"}getDescription(){return"Configure optional plugins"}};var lt=require("obsidian");var Ie=require("obsidian");var ke=class{constructor(t){this.app=t}async createOrUpdateBaseFile(t,n,i){let r="bases/Home.base";if(!this.app.vault.getAbstractFileByPath("bases"))try{await this.app.vault.createFolder("bases")}catch(u){(!u.message||!u.message.includes("already exists"))&&console.warn("BasesCMSConfig: Could not create bases folder:",u)}let o=this.app.vault.getAbstractFileByPath(r),s=null;if(o&&o instanceof Ie.TFile)try{let u=await this.app.vault.read(o);s=Fe(u)}catch(u){console.error("BasesCMSConfig: Failed to parse existing base file:",u)}let l=t.filter(u=>u.enabled);console.log("BasesCMSConfig: Generating base content for",t.length,"content types"),console.log("BasesCMSConfig: Enabled content types:",l.map(u=>u.name));let c=this.generateBaseContent(t,n,i,s),p=c.match(/^\s*-\s+type:\s+bases-cms/gm),f=p?p.length:0;if(console.log("BasesCMSConfig: Generated",f,"views in base content"),o=this.app.vault.getAbstractFileByPath(r),o&&o instanceof Ie.TFile){console.log("BasesCMSConfig: Modifying existing Home.base file");try{await this.app.vault.modify(o,c),console.log("BasesCMSConfig: Successfully modified Home.base file");return}catch(u){throw console.error("BasesCMSConfig: Failed to modify file:",u),u}}console.log("BasesCMSConfig: Creating new Home.base file");try{await this.app.vault.create(r,c),console.log("BasesCMSConfig: Successfully created Home.base file")}catch(u){if(u.message&&(u.message.includes("already exists")||u.message.includes("File already exists"))){console.log("BasesCMSConfig: File existed, attempting direct modify via path");try{let d=this.app.vault.adapter;if(d&&typeof d.write=="function")await d.write(r,c),console.log("BasesCMSConfig: Successfully wrote Home.base file via adapter");else{console.log("BasesCMSConfig: Adapter write not available, retrying getAbstractFileByPath");for(let g=0;g<10;g++){await new Promise(x=>setTimeout(x,200));let h=this.app.vault.getAbstractFileByPath(r);if(h&&h instanceof Ie.TFile){await this.app.vault.modify(h,c),console.log(`BasesCMSConfig: Successfully modified Home.base file on retry ${g+1}`);return}}throw console.error("BasesCMSConfig: File exists but cannot be found after all retries"),new Error("File exists but cannot be accessed. Please try again or manually edit bases/Home.base")}}catch(d){throw console.error("BasesCMSConfig: Failed to write file via adapter:",d),d}}else throw console.error("BasesCMSConfig: Failed to create base file:",u),u}}generateBaseContent(t,n,i,r){var u;let a=[];if(r!=null&&r.formulas){a.push("formulas:");for(let[d,g]of Object.entries(r.formulas))if(typeof g=="string"){a.push(`  ${d}: |-`);let h=g.split(`
`);for(let x of h)a.push(`    ${x}`)}a.push("")}a.push("filters:"),a.push("  and:"),a.push('    - file.ext == "md"'),a.push("");let o=new Set;for(let d of t){let g=n[d.id];g&&(o.add(`note.${g.titleProperty}`),o.add(`note.${g.dateProperty}`),g.descriptionProperty&&o.add(`note.${g.descriptionProperty}`),g.tagsProperty&&o.add(`note.${g.tagsProperty}`),g.draftProperty&&o.add(`note.${g.draftProperty}`),g.imageProperty&&o.add(`note.${g.imageProperty}`))}if(o.add("note.title"),o.add("note.date"),o.add("note.pubDate"),o.add("note.draft"),o.add("file.name"),r!=null&&r.properties)for(let d of Object.keys(r.properties))d.startsWith("formula.")&&o.add(d);if(o.size>0){a.push("properties:");let d=(r==null?void 0:r.properties)||{};for(let g of Array.from(o).sort())if(a.push(`  ${g}:`),(u=d[g])!=null&&u.displayName)a.push(`    displayName: ${d[g].displayName}`);else{let h=g.replace("note.","").replace("file.","");a.push(`    displayName: ${this.capitalizeFirst(h)}`)}a.push("")}a.push("views:");let s=i?t.find(d=>d.id===i&&d.enabled):null,l=(r==null?void 0:r.views)||[],c=new Set(t.filter(d=>d.enabled).map(d=>d.name)),p=l.find(d=>d.name==="Guide"),f=l.filter(d=>d.name!=="All Content"&&d.name!=="Guide"&&!c.has(d.name));if(s){let d=n[s.id];d&&(a.push("  - type: bases-cms"),a.push(`    name: ${s.name}`),a.push("    filters:"),a.push("      and:"),a.push(`        - file.folder.startsWith("${s.folder}")`),a.push("    imageFormat: cover"),d.titleProperty?a.push(`    titleProperty: note.${d.titleProperty}`):a.push("    titleProperty: file.name"),d.dateProperty?a.push(`    dateProperty: note.${d.dateProperty}`):a.push("    dateProperty: file.ctime"),d.descriptionProperty&&a.push(`    descriptionProperty: note.${d.descriptionProperty}`),d.imageProperty&&a.push(`    imageProperty: note.${d.imageProperty}`),a.push(`    showTags: ${d.tagsProperty?"true":"false"}`),d.tagsProperty&&a.push(`    tagsProperty: note.${d.tagsProperty}`),a.push("    showDate: true"),a.push(`    showDraftStatus: ${d.draftProperty?"true":"false"}`),d.draftProperty&&a.push(`    draftStatusProperty: note.${d.draftProperty}`),a.push("    customizeNewButton: true"),a.push(`    newNoteLocation: "${s.folder}"`),a.push("    fallbackToEmbeds: if-empty"),a.push("    propertyDisplay1: file.name"),a.push("    showTextPreview: true"),a.push("    propertyLabels: above"),a.push("    sort:"),a.push(`      - property: ${d.dateProperty?`note.${d.dateProperty}`:"file.ctime"}`),a.push("        direction: DESC"))}for(let d of t){if(!d.enabled||d.name==="All Content"||s&&d.id===s.id)continue;let g=n[d.id];g&&(a.push("  - type: bases-cms"),a.push(`    name: ${d.name}`),a.push("    filters:"),a.push("      and:"),a.push(`        - file.folder.startsWith("${d.folder}")`),a.push("    imageFormat: cover"),g.titleProperty?a.push(`    titleProperty: note.${g.titleProperty}`):a.push("    titleProperty: file.name"),g.dateProperty?a.push(`    dateProperty: note.${g.dateProperty}`):a.push("    dateProperty: file.ctime"),g.descriptionProperty&&a.push(`    descriptionProperty: note.${g.descriptionProperty}`),g.imageProperty&&a.push(`    imageProperty: note.${g.imageProperty}`),a.push(`    showTags: ${g.tagsProperty?"true":"false"}`),g.tagsProperty&&a.push(`    tagsProperty: note.${g.tagsProperty}`),a.push("    showDate: true"),a.push(`    showDraftStatus: ${g.draftProperty?"true":"false"}`),g.draftProperty&&a.push(`    draftStatusProperty: note.${g.draftProperty}`),a.push("    customizeNewButton: true"),a.push(`    newNoteLocation: "${d.folder}"`),a.push("    fallbackToEmbeds: if-empty"),a.push("    propertyDisplay1: file.name"),a.push("    showTextPreview: true"),a.push("    propertyLabels: above"),a.push("    sort:"),a.push(`      - property: ${g.dateProperty?`note.${g.dateProperty}`:"file.ctime"}`),a.push("        direction: DESC"))}for(let d of f)a.push(...this.serializeView(d));return p&&a.push(...this.serializeView(p)),a.join(`
`)}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}serializeView(t){let n=[];if(n.push("  - type: bases-cms"),n.push(`    name: ${t.name}`),t.filters&&(n.push("    filters:"),t.filters.and)){n.push("      and:");for(let r of t.filters.and)if(typeof r=="string")n.push(`        - ${r}`);else if(typeof r=="object")for(let[a,o]of Object.entries(r))n.push(`        - ${a}: ${typeof o=="string"?`"${o}"`:o}`)}if(t.groupBy&&(n.push("    groupBy:"),typeof t.groupBy=="object"&&(t.groupBy.property&&n.push(`      property: ${t.groupBy.property}`),t.groupBy.direction&&n.push(`      direction: ${t.groupBy.direction}`))),t.order){n.push("    order:");for(let r of t.order)n.push(`      - ${r}`)}if(t.sort){n.push("    sort:");for(let r of t.sort)typeof r=="object"&&r.property&&(n.push(`      - property: ${r.property}`),n.push(`        direction: ${r.direction||"ASC"}`))}let i=["type","name","filters","groupBy","order","sort"];for(let r of Object.keys(t)){if(i.includes(r)||t[r]===void 0)continue;let a=t[r];typeof a=="boolean"?n.push(`    ${r}: ${a}`):typeof a=="number"?n.push(`    ${r}: ${a}`):typeof a=="string"&&(r.includes("Property")&&(a.startsWith("note.")||a.startsWith("file."))?n.push(`    ${r}: ${a}`):r==="newNoteLocation"?n.push(`    ${r}: ${a}`):n.push(`    ${r}: "${a}"`))}return n}};var Me=class{constructor(t){this.app=t}generateSEOConfig(t,n){let i=t.find(o=>o.enabled),r=i?n[i.id]:void 0;return{titleProperty:(r==null?void 0:r.titleProperty)||"title",descriptionProperty:r==null?void 0:r.descriptionProperty,scanDirectories:t.filter(o=>o.enabled).map(o=>o.folder).join(","),keywordProperty:"targetKeyword",useFilenameAsTitle:!1,useFilenameAsSlug:!0}}async saveConfig(t){let i=".obsidian/plugins/seo/data.json";try{let r=this.app.vault.getAbstractFileByPath(i);if(r){let o={...JSON.parse(await this.app.vault.read(r)),...t};await this.app.vault.modify(r,JSON.stringify(o,null,2))}}catch(r){console.error("Failed to save SEO config:",r)}}};var ce=require("obsidian"),je=class{constructor(t){this.app=t}generateCommanderConfig(t){return{pageHeaderCommands:[]}}async toggleEditingToolbarCommand(t,n){var i,r,a;console.log(`CommanderConfig: toggleEditingToolbarCommand called with enable=${n}`);try{let o=t.plugins;if(!o){console.warn("CommanderConfig: Plugins API not available");return}let s=(i=o.plugins)==null?void 0:i["editing-toolbar"];if(!s){console.warn("CommanderConfig: Editing Toolbar plugin not found");return}if(console.log(`CommanderConfig: Editing Toolbar plugin found, enabled=${s.enabled}`),console.log("CommanderConfig: Plugin settings available:",!!s.settings),s.settings&&console.log("CommanderConfig: Current cMenuVisibility:",s.settings.cMenuVisibility),n&&!s.enabled?(console.log("CommanderConfig: Enabling editing-toolbar plugin"),await o.enablePlugin("editing-toolbar")):!n&&s.enabled&&(console.log("CommanderConfig: Disabling editing-toolbar plugin"),await o.disablePlugin("editing-toolbar")),s.settings&&typeof s.saveSettings=="function"){console.log("CommanderConfig: Using plugin.saveSettings() method");let l=s.settings.cMenuVisibility;if(s.settings.cMenuVisibility=n,console.log(`CommanderConfig: Set cMenuVisibility from ${l} to ${n}`),await s.saveSettings(),console.log("CommanderConfig: Successfully saved editing-toolbar via plugin.saveSettings()"),s.settings.cMenuVisibility===n?console.log(`CommanderConfig: Verified cMenuVisibility is now ${s.settings.cMenuVisibility}`):console.error(`CommanderConfig: ERROR - cMenuVisibility is ${s.settings.cMenuVisibility}, expected ${n}`),n){console.log("CommanderConfig: Waiting for settings to persist..."),await new Promise(c=>setTimeout(c,500)),typeof s.loadSettings=="function"&&(console.log("CommanderConfig: Reloading editing toolbar plugin settings"),await s.loadSettings()),typeof s.refresh=="function"&&(console.log("CommanderConfig: Refreshing editing toolbar plugin"),s.refresh()),console.log("CommanderConfig: Executing editing-toolbar:hide-show-menu command");try{for(let c=0;c<3;c++){let p=(a=(r=t.commands)==null?void 0:r.commands)==null?void 0:a["editing-toolbar:hide-show-menu"];console.log(`CommanderConfig: Command found (attempt ${c+1}):`,!!p),p?(setTimeout(()=>{t.commands.executeCommandById("editing-toolbar:hide-show-menu")},c*500),console.log(`CommanderConfig: Scheduled hide-show-menu command (attempt ${c+1})`)):console.warn(`CommanderConfig: Command editing-toolbar:hide-show-menu not found (attempt ${c+1})`)}}catch(c){console.error("CommanderConfig: Failed to execute editing toolbar show command:",c)}}return}else console.log("CommanderConfig: Plugin saveSettings not available, using fallback");await this.toggleEditingToolbarCommandFallback(t,n)}catch(o){console.error("CommanderConfig: Failed to toggle editing toolbar plugin:",o);try{await this.toggleEditingToolbarCommandFallback(t,n)}catch(s){console.error("CommanderConfig: Failed to toggle editing toolbar via fallback:",s)}}}async toggleEditingToolbarCommandFallback(t,n){var s;let i="editing-toolbar",r=`.obsidian/plugins/${i}/data.json`,a={},o=t.vault.getAbstractFileByPath(r);if(o&&o instanceof ce.TFile)try{a=JSON.parse(await t.vault.read(o))}catch(l){console.warn("Failed to parse existing editing-toolbar data.json, starting fresh:",l),a={}}if(a.cMenuVisibility=n,o&&o instanceof ce.TFile)await t.vault.modify(o,JSON.stringify(a,null,2)),console.log("CommanderConfig: Successfully saved editing-toolbar via file modify");else{let l=`.obsidian/plugins/${i}`;if(!t.vault.getAbstractFileByPath(l))try{await t.vault.createFolder(l)}catch(p){if(p.message&&!p.message.includes("already exists")&&!p.message.includes("File already exists")&&!p.message.includes("Folder already exists"))throw p}try{await t.vault.create(r,JSON.stringify(a,null,2)),console.log("CommanderConfig: Successfully created editing-toolbar data.json")}catch(p){if(p.message&&(p.message.includes("already exists")||p.message.includes("File already exists"))){let f=t.vault.getAbstractFileByPath(r);if(f&&f instanceof ce.TFile)await t.vault.modify(f,JSON.stringify(a,null,2)),console.log("CommanderConfig: Successfully saved editing-toolbar via retry modify");else{await new Promise(d=>setTimeout(d,200));let u=t.vault.getAbstractFileByPath(r);if(u&&u instanceof ce.TFile)await t.vault.modify(u,JSON.stringify(a,null,2)),console.log("CommanderConfig: Successfully saved editing-toolbar via delayed retry modify");else throw p}}else throw p}}if(n)try{await((s=t.commands)==null?void 0:s.executeCommandById("editing-toolbar:hide-show-menu"))}catch(l){console.warn("Failed to execute editing toolbar show command:",l)}}async saveConfig(t){let i=".obsidian/plugins/cmdr/data.json";try{let r=this.app.vault.getAbstractFileByPath(i);if(r){let a=JSON.parse(await this.app.vault.read(r)),o=a.pageHeader||[],s={id:"editing-toolbar:hide-show-menu",icon:"lucide-chevrons-up-down",name:"Toggle editing toolbar",mode:"desktop"},l=o.filter(p=>p.id!=="editing-toolbar:hide-show-menu");t.pageHeaderCommands.length>0&&l.push(s);let c={...a,pageHeader:l};await this.app.vault.modify(r,JSON.stringify(c,null,2))}}catch(r){console.error("Failed to save Commander config:",r)}}};var Le=class{constructor(t){this.app=t}async saveConfig(t){let i=".obsidian/plugins/property-over-file-name/data.json";try{let r=this.app.vault.getAbstractFileByPath(i);if(r){let o={...JSON.parse(await this.app.vault.read(r)),...t};await this.app.vault.modify(r,JSON.stringify(o,null,2))}}catch(r){console.error("Failed to save Property Over File Name config:",r)}}};var _e=require("obsidian"),Be=class{constructor(t){this.app=t}async saveConfig(t,n){var a;let i="insert-unsplash-image",r=`.obsidian/plugins/${i}/data.json`;try{let o=this.app.plugins,s=(a=o==null?void 0:o.plugins)==null?void 0:a[i];if(s&&s.settings){let l=s.settings;if(l.frontmatter||(l.frontmatter={}),t.valueFormat&&(l.frontmatter.valueFormat=t.valueFormat),n&&(l.frontmatter.key=n),typeof s.saveSettings=="function"){await s.saveSettings(),console.log("ImageInserterConfig: Successfully saved via plugin.saveSettings()");return}}await this.saveConfigFallback(t,n)}catch(o){console.error("Failed to save Image Inserter config:",o);try{await this.saveConfigFallback(t,n)}catch(s){console.error("Failed to save Image Inserter config via fallback:",s)}}}async saveConfigFallback(t,n){let i="insert-unsplash-image",r=`.obsidian/plugins/${i}/data.json`,a={},o=this.app.vault.getAbstractFileByPath(r);if(o&&o instanceof _e.TFile)try{a=JSON.parse(await this.app.vault.read(o))}catch(l){console.warn("Failed to parse existing Image Inserter data.json, starting fresh:",l),a={}}let s={...a};if(s.frontmatter||(s.frontmatter={}),t.valueFormat&&(s.frontmatter.valueFormat=t.valueFormat),n&&(s.frontmatter.key=n),o&&o instanceof _e.TFile)await this.app.vault.modify(o,JSON.stringify(s,null,2));else{let l=`.obsidian/plugins/${i}`;if(!this.app.vault.getAbstractFileByPath(l))try{await this.app.vault.createFolder(l)}catch(p){if(!p.message||!p.message.includes("already exists")&&!p.message.includes("File already exists"))throw p}try{await this.app.vault.create(r,JSON.stringify(s,null,2))}catch(p){if(p.message&&(p.message.includes("already exists")||p.message.includes("File already exists"))){let f=this.app.vault.getAbstractFileByPath(r);if(f&&f instanceof _e.TFile)await this.app.vault.modify(f,JSON.stringify(s,null,2));else throw p}else throw p}}}};var $e=require("obsidian"),Re=class{constructor(t){this.app=t}async saveConfig(t){var r;let n="simple-banner",i=`.obsidian/plugins/${n}/data.json`;try{let a=this.app.plugins,o=(r=a==null?void 0:a.plugins)==null?void 0:r[n];if(o&&o.settings&&(o.settings.properties||(o.settings.properties={}),o.settings.properties.image=t,typeof o.saveSettings=="function")){await o.saveSettings(),console.log("SimpleBannerConfig: Successfully saved via plugin.saveSettings()");return}await this.saveConfigFallback(t)}catch(a){console.error("Failed to save Simple Banner config:",a);try{await this.saveConfigFallback(t)}catch(o){console.error("Failed to save Simple Banner config via fallback:",o)}}}async saveConfigFallback(t){let n="simple-banner",i=`.obsidian/plugins/${n}/data.json`,r={},a=this.app.vault.getAbstractFileByPath(i);if(a&&a instanceof $e.TFile)try{r=JSON.parse(await this.app.vault.read(a))}catch(o){console.warn("Failed to parse existing Simple Banner data.json, starting fresh:",o),r={}}if(r.properties||(r.properties={}),r.properties.image=t,a&&a instanceof $e.TFile)await this.app.vault.modify(a,JSON.stringify(r,null,2));else{let o=`.obsidian/plugins/${n}`;if(!this.app.vault.getAbstractFileByPath(o))try{await this.app.vault.createFolder(o)}catch(l){if(!l.message||!l.message.includes("already exists")&&!l.message.includes("File already exists"))throw l}try{await this.app.vault.create(i,JSON.stringify(r,null,2))}catch(l){if(l.message&&(l.message.includes("already exists")||l.message.includes("File already exists"))){let c=this.app.vault.getAbstractFileByPath(i);if(c&&c instanceof $e.TFile)await this.app.vault.modify(c,JSON.stringify(r,null,2));else throw l}else throw l}}}};var ze=class extends A{constructor(n,i,r,a,o,s){super(n,i,r,a,o,s);this.applied=!1;this.pluginManager=new ne(n),this.basesCMSConfigurator=new ke(n),this.astroComposerConfigurator=new J(n),this.seoConfigurator=new Me(n),this.commanderConfigurator=new je(n),this.propertyOverFileNameConfigurator=new Le(n),this.imageInserterConfigurator=new Be(n),this.simpleBannerConfigurator=new Re(n)}display(){let{containerEl:n}=this;n.empty(),n.createEl("h2",{text:"Finalize Configuration"}),n.createEl("p",{text:'Review your configuration and click "Apply" to save all settings:'});let i=n.createEl("div",{cls:"finalize-summary"});i.createEl("h3",{text:"Summary"});let r=this.state.contentTypes.filter(p=>p.enabled);i.createEl("p",{text:`Content Types: ${r.length}`}),i.createEl("p",{text:`WYSIWYG Toolbar: ${this.state.enableWYSIWYG?"Enabled":"Disabled"}`});let a=r.length;i.createEl("p",{text:`Bases CMS Views: ${a} new view${a!==1?"s":""} to be created`});let o=r.map(p=>p.folder),s=o.length;i.createEl("p",{text:`SEO Scan Directories: ${s} director${s!==1?"ies":"y"} (${o.join(", ")})`});let l=n.createDiv();l.style.marginBottom="30px",l.createEl("button",{text:"Apply Configuration",cls:"mod-cta"}).addEventListener("click",async()=>{await this.applyConfiguration()})}async applyConfiguration(){if(!this.applied)try{if(console.log("FinalizeStep: Starting configuration application"),console.log("FinalizeStep: Enabled content types:",this.state.contentTypes.filter(s=>s.enabled).map(s=>s.name)),console.log("FinalizeStep: Configuring plugin states"),await this.pluginManager.setPluginStates(this.state.enabledPlugins,this.state.disabledPlugins),console.log("FinalizeStep: Configuring Bases CMS"),await this.basesCMSConfigurator.createOrUpdateBaseFile(this.state.contentTypes,this.state.frontmatterProperties,this.state.defaultContentTypeId),console.log("FinalizeStep: Bases CMS configuration complete"),this.state.projectDetection){let s=await this.astroComposerConfigurator.configureAstroComposer(this.state.contentTypes,this.state.frontmatterProperties,this.state.projectDetection.projectRoot,this.state.projectDetection.configFilePath,this.state.defaultContentTypeId);this.state.astroComposerConfig=s,await this.astroComposerConfigurator.saveConfig(s)}let n=this.seoConfigurator.generateSEOConfig(this.state.contentTypes,this.state.frontmatterProperties);this.state.seoConfig=n,await this.seoConfigurator.saveConfig(n),console.log(`FinalizeStep: Configuring editing toolbar, enableWYSIWYG=${this.state.enableWYSIWYG}`),await this.commanderConfigurator.toggleEditingToolbarCommand(this.app,this.state.enableWYSIWYG);let i=this.commanderConfigurator.generateCommanderConfig(this.state.enableWYSIWYG);this.state.commanderConfig=i,await this.commanderConfigurator.saveConfig(i);let r=this.state.contentTypes.find(s=>s.enabled),a=r?this.state.frontmatterProperties[r.id]:void 0;a&&a.titleProperty&&(this.state.propertyOverFileName.propertyKey=a.titleProperty,await this.propertyOverFileNameConfigurator.saveConfig(this.state.propertyOverFileName));let o=a==null?void 0:a.imageProperty;if(o&&this.state.enabledPlugins.includes("simple-banner")&&await this.simpleBannerConfigurator.saveConfig(o),o&&this.state.enabledPlugins.includes("insert-unsplash-image")){let s={...this.state.imageInserter};if(this.state.attachmentHandlingMode==="same-folder")s.valueFormat="[[{image-url}]]",s.insertFormat="[[{image-url}]]";else{let l=this.state.attachmentFolderName||"attachments";s.valueFormat=`[[${l}/{image-url}]]`,s.insertFormat=`[[${l}/{image-url}]]`}await this.imageInserterConfigurator.saveConfig(s,o)}if(this.state.defaultContentTypeId){let s=this.state.contentTypes.find(l=>l.id===this.state.defaultContentTypeId);if(s){console.log("FinalizeStep: Configuring Obsidian settings for default content type:",s.name);let l=this.app,c="./";if(this.state.attachmentHandlingMode==="same-folder"?c="./":this.state.attachmentHandlingMode==="subfolder"?c=`./${this.state.attachmentFolderName||"attachments"}`:this.state.attachmentHandlingMode==="specified-folder"&&(c=this.state.attachmentFolderName||"attachments"),l.setting&&typeof l.setting.set=="function")console.log("FinalizeStep: Using app.setting API"),await l.setting.set("newFileLocation","folder"),await l.setting.set("newFileFolderPath",s.folder),await l.setting.set("attachmentFolderPath",c),await l.setting.set("newLinkFormat","relative"),typeof l.setting.save=="function"&&(await l.setting.save(),console.log("FinalizeStep: Obsidian settings saved via app.setting.save()"));else{console.log("FinalizeStep: Using vault.config API");let p=this.app.vault.config;p?(p.newFileLocation="folder",p.newFileFolderPath=s.folder,p.attachmentFolderPath=c,p.newLinkFormat="relative",typeof this.app.vault.saveConfig=="function"?(await this.app.vault.saveConfig(),console.log("FinalizeStep: Obsidian settings saved via vault.saveConfig()")):console.error("FinalizeStep: vault.saveConfig() is not available")):console.error("FinalizeStep: vault.config is not available")}}}this.applied=!0,new lt.Notice("Configuration applied successfully!")}catch(n){console.error("Failed to apply configuration:",n),new lt.Notice("Failed to apply configuration. Please check the console for details.")}}validate(){return!0}getTitle(){return"Finalize"}getDescription(){return"Review and apply configuration"}};var H=class extends nn.Modal{constructor(n,i,r){var o,s,l,c,p,f,u,d,g,h,x,w,b,m,C,v,F,O;super(n);this.currentStepIndex=0;this.currentStepInstance=null;this.pluginInstance=r;let a=(i==null?void 0:i.projectDetection)||((o=r==null?void 0:r.settings)!=null&&o.projectRoot&&((s=r==null?void 0:r.settings)!=null&&s.configFilePath)?{projectRoot:r.settings.projectRoot,configFilePath:r.settings.configFilePath,vaultLocation:"content"}:void 0);this.state={currentStep:0,contentTypes:(i==null?void 0:i.contentTypes)||((l=r==null?void 0:r.settings)==null?void 0:l.contentTypes)||[],frontmatterProperties:(i==null?void 0:i.frontmatterProperties)||((c=r==null?void 0:r.settings)==null?void 0:c.frontmatterProperties)||{},projectDetection:a,defaultContentTypeId:(i==null?void 0:i.defaultContentTypeId)||((p=r==null?void 0:r.settings)==null?void 0:p.defaultContentTypeId),attachmentHandlingMode:(i==null?void 0:i.attachmentHandlingMode)||"subfolder",attachmentFolderName:i==null?void 0:i.attachmentFolderName,preset:(i==null?void 0:i.preset)||((f=r==null?void 0:r.settings)==null?void 0:f.preset)||"vanilla",enableWYSIWYG:(g=(d=i==null?void 0:i.enableWYSIWYG)!=null?d:(u=r==null?void 0:r.settings)==null?void 0:u.enableWYSIWYG)!=null?g:!1,enabledPlugins:(i==null?void 0:i.enabledPlugins)||((h=r==null?void 0:r.settings)==null?void 0:h.enabledPlugins)||[],disabledPlugins:(i==null?void 0:i.disabledPlugins)||((x=r==null?void 0:r.settings)==null?void 0:x.disabledPlugins)||[],theme:(i==null?void 0:i.theme)||((w=r==null?void 0:r.settings)==null?void 0:w.theme)||"",basesCMSConfig:(i==null?void 0:i.basesCMSConfig)||((b=r==null?void 0:r.settings)==null?void 0:b.basesCMSConfig)||{views:[]},astroComposerConfig:(i==null?void 0:i.astroComposerConfig)||((m=r==null?void 0:r.settings)==null?void 0:m.astroComposerConfig)||{customContentTypes:[],defaultTemplate:"",configFilePath:"",terminalProjectRootPath:""},seoConfig:(i==null?void 0:i.seoConfig)||((C=r==null?void 0:r.settings)==null?void 0:C.seoConfig)||{titleProperty:"title",scanDirectories:"",useFilenameAsTitle:!1,useFilenameAsSlug:!0},commanderConfig:(i==null?void 0:i.commanderConfig)||((v=r==null?void 0:r.settings)==null?void 0:v.commanderConfig)||{pageHeaderCommands:[]},propertyOverFileName:(i==null?void 0:i.propertyOverFileName)||((F=r==null?void 0:r.settings)==null?void 0:F.propertyOverFileName)||{propertyKey:"title"},imageInserter:(i==null?void 0:i.imageInserter)||((O=r==null?void 0:r.settings)==null?void 0:O.imageInserter)||{valueFormat:"[[attachments/{image-url}]]",insertFormat:"[[attachments/{image-url}]]"},...i},this.steps=[de,ge,he,ye,Te,Se,Ee,De,Ne,Oe,ze]}onOpen(){let{contentEl:n}=this;n.empty(),this.displayCurrentStep().catch(i=>{console.error("Error displaying wizard step:",i)})}onClose(){let{contentEl:n}=this;n.empty()}async displayCurrentStep(){let{contentEl:n}=this;if(n.empty(),this.currentStepIndex>=this.steps.length){this.close();return}let i=this.steps[this.currentStepIndex],r=i.name||"Unknown";console.log(`SetupWizardModal: Displaying step ${this.currentStepIndex+1}/${this.steps.length}: ${r}`),this.currentStepInstance=new i(this.app,n,this.state,()=>this.nextStep(),()=>this.previousStep(),()=>this.close()),await this.currentStepInstance.display(),this.state.currentStep=this.currentStepIndex;let o=n.createDiv({cls:"wizard-footer"}).createDiv({cls:"wizard-buttons"});if(o.style.display="flex",o.style.gap="10px",this.currentStepIndex>0&&o.createEl("button",{text:"Previous",cls:"mod-button"}).addEventListener("click",async()=>{await this.previousStep()}),this.currentStepIndex<this.steps.length-1){o.createEl("button",{text:"Next",cls:"mod-button mod-cta"}).addEventListener("click",async()=>{this.currentStepInstance&&this.currentStepInstance.validate()&&(await this.saveCurrentStepState(),await this.nextStep())});let l=o.createEl("button",{text:"Skip",cls:"mod-button"});l.style.opacity="0.6",l.addEventListener("click",async()=>{await this.nextStep()})}else o.createEl("button",{text:"Complete Setup",cls:"mod-button mod-cta"}).addEventListener("click",async()=>{this.currentStepInstance&&this.currentStepInstance.validate()&&(await this.saveStateIfNeeded(),this.close())})}async nextStep(){this.currentStepIndex<this.steps.length-1?(this.currentStepIndex++,await this.displayCurrentStep()):(await this.saveStateIfNeeded(),this.close())}async saveCurrentStepState(){var n,i;try{this.saveCallback&&this.pluginInstance&&(this.pluginInstance.settings.projectRoot=((n=this.state.projectDetection)==null?void 0:n.projectRoot)||"",this.pluginInstance.settings.configFilePath=((i=this.state.projectDetection)==null?void 0:i.configFilePath)||"",this.pluginInstance.settings.contentTypes=this.state.contentTypes,this.pluginInstance.settings.frontmatterProperties=this.state.frontmatterProperties,this.pluginInstance.settings.defaultContentTypeId=this.state.defaultContentTypeId,this.pluginInstance.settings.preset=this.state.preset,this.pluginInstance.settings.enableWYSIWYG=this.state.enableWYSIWYG,this.pluginInstance.settings.enabledPlugins=this.state.enabledPlugins,this.pluginInstance.settings.disabledPlugins=this.state.disabledPlugins,this.pluginInstance.settings.theme=this.state.theme,this.pluginInstance.settings.basesCMSConfig=this.state.basesCMSConfig,this.pluginInstance.settings.astroComposerConfig=this.state.astroComposerConfig,this.pluginInstance.settings.seoConfig=this.state.seoConfig,this.pluginInstance.settings.commanderConfig=this.state.commanderConfig,this.pluginInstance.settings.propertyOverFileName=this.state.propertyOverFileName,this.pluginInstance.settings.imageInserter=this.state.imageInserter,await this.pluginInstance.saveSettings())}catch(r){console.error("Error saving current step state:",r)}}async previousStep(){this.currentStepIndex>0&&(this.currentStepIndex--,await this.displayCurrentStep())}getState(){return this.state}setSaveCallback(n){this.saveCallback=n}async saveStateIfNeeded(){this.saveCallback&&this.currentStepIndex===this.steps.length-1&&await this.saveCallback(this.state)}};var We=class extends pe.PluginSettingTab{constructor(n,i){super(n,i);this.plugin=i}display(){let{containerEl:n}=this;n.empty(),new pe.Setting(n).setName("Open Setup Wizard").setDesc("Launch the setup wizard to configure Vault CMS").addButton(i=>i.setButtonText("Open Wizard").setCta().onClick(()=>{new H(this.app,this.plugin.settings,this.plugin).open()})),new pe.Setting(n).setName("Run Wizard on Startup").setDesc("Automatically open the wizard when the plugin loads").addToggle(i=>i.setValue(this.plugin.settings.runWizardOnStartup).onChange(async r=>{this.plugin.settings.runWizardOnStartup=r,await this.plugin.saveSettings()}))}};function rn(e){e.addCommand({id:"vault-cms-open-wizard",name:"Open Setup Wizard",callback:()=>{let t=new H(e.app,e.settings,e);t.setSaveCallback(async n=>{var i,r;e.settings.projectRoot=((i=n.projectDetection)==null?void 0:i.projectRoot)||"",e.settings.configFilePath=((r=n.projectDetection)==null?void 0:r.configFilePath)||"",e.settings.contentTypes=n.contentTypes,e.settings.frontmatterProperties=n.frontmatterProperties,e.settings.defaultContentTypeId=n.defaultContentTypeId,e.settings.preset=n.preset,e.settings.enableWYSIWYG=n.enableWYSIWYG,e.settings.enabledPlugins=n.enabledPlugins,e.settings.disabledPlugins=n.disabledPlugins,e.settings.theme=n.theme,e.settings.basesCMSConfig=n.basesCMSConfig,e.settings.astroComposerConfig=n.astroComposerConfig,e.settings.seoConfig=n.seoConfig,e.settings.commanderConfig=n.commanderConfig,e.settings.propertyOverFileName=n.propertyOverFileName,e.settings.imageInserter=n.imageInserter,e.settings.wizardCompleted=!0,await e.saveSettings()}),t.open()}})}var Ye=class extends on.Plugin{async onload(){await this.loadSettings(),rn(this),this.addSettingTab(new We(this.app,this)),this.settings.runWizardOnStartup&&this.app.workspace.onLayoutReady(()=>{this.startupTimeoutId=window.setTimeout(async()=>{if(await this.loadSettings(),this.settings.runWizardOnStartup){let n=new H(this.app,this.settings,this);n.setSaveCallback(async i=>{var r,a;this.settings.projectRoot=((r=i.projectDetection)==null?void 0:r.projectRoot)||"",this.settings.configFilePath=((a=i.projectDetection)==null?void 0:a.configFilePath)||"",this.settings.contentTypes=i.contentTypes,this.settings.frontmatterProperties=i.frontmatterProperties,this.settings.defaultContentTypeId=i.defaultContentTypeId,this.settings.preset=i.preset,this.settings.enableWYSIWYG=i.enableWYSIWYG,this.settings.enabledPlugins=i.enabledPlugins,this.settings.disabledPlugins=i.disabledPlugins,this.settings.theme=i.theme,this.settings.basesCMSConfig=i.basesCMSConfig,this.settings.astroComposerConfig=i.astroComposerConfig,this.settings.seoConfig=i.seoConfig,this.settings.commanderConfig=i.commanderConfig,this.settings.propertyOverFileName=i.propertyOverFileName,this.settings.imageInserter=i.imageInserter,this.settings.wizardCompleted=!0,await this.saveSettings()}),n.open()}},2e3)})}onunload(){this.startupTimeoutId&&window.clearTimeout(this.startupTimeoutId)}async loadSettings(){this.settings=Object.assign({},pt,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT *)
*/
